(window.webpackJsonp=window.webpackJsonp||[]).push([[215],{568:function(t,e,a){"use strict";a.r(e);var n=a(16),s=Object(n.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"通过导航和资源定时评估加载性能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过导航和资源定时评估加载性能"}},[t._v("#")]),t._v(" 通过导航和资源定时评估加载性能")]),t._v(" "),a("p",[t._v("您很有可能在某个时候打开了浏览器的开发工具，使用"),a("a",{attrs:{href:"https://developers.google.cn/web/tools/chrome-devtools/network-performance",target:"_blank",rel:"noopener noreferrer"}},[t._v("network panel"),a("OutboundLink")],1),t._v("（甚至可能是 "),a("a",{attrs:{href:"https://developers.google.cn/web/tools/lighthouse",target:"_blank",rel:"noopener noreferrer"}},[t._v("Lighthouse"),a("OutboundLink")],1),t._v("）来评估性能，并发现了改进的机会。然后，您重构了代码，提高了性能，观看了指标的改进，并向自己表示了祝贺。做得好！")]),t._v(" "),a("p",[t._v("只有您还"),a("em",[t._v("没有")]),t._v("完成，因为问题仍然存在：您执行的测试是"),a("a",{attrs:{href:"https://developers.google.cn/web/fundamentals/performance/speed-tools#lab_data",target:"_blank",rel:"noopener noreferrer"}},[t._v("synthetic"),a("OutboundLink")],1),t._v("测试 。他们没有告诉您您的网站"),a("a",{attrs:{href:"https://developers.google.cn/web/fundamentals/performance/speed-tools#field_data",target:"_blank",rel:"noopener noreferrer"}},[t._v("在该领域"),a("OutboundLink")],1),t._v("对"),a("a",{attrs:{href:"https://developers.google.cn/web/fundamentals/performance/speed-tools#field_data",target:"_blank",rel:"noopener noreferrer"}},[t._v("真实用户的"),a("OutboundLink")],1),t._v("表现如何。")]),t._v(" "),a("p",[t._v("并不是说综合测试很"),a("em",[t._v("糟糕")]),t._v("，而是它只是更大的加载性能图的一部分。不管您使用多少个综合测试工具，它们都只能从一个角度提供数据：从任何设备和网络连接运行测试。当然，基于综合测试建议所做的改进将对所有用户有所帮助，但是只要综合测试仍然是您唯一的性能衡量策略，您在"),a("em",[t._v("多大程度上")]),t._v("都不了解。")]),t._v(" "),a("p",[t._v("这是真正用户监视（RUM）的地方。RUM 依靠浏览器中的 JavaScript API 来收集有关网站对"),a("em",[t._v("真实用户的")]),t._v("表现的统计信息。两种特定的 API 通过捕获 可测量资源加载各个阶段的"),a("a",{attrs:{href:"https://developers.google.cn/web/updates/2012/08/When-milliseconds-are-not-enough-performance-now",target:"_blank",rel:"noopener noreferrer"}},[t._v("高分辨率时序"),a("OutboundLink")],1),t._v("来衡量用户如何快速加载文档和资源。这些是网络和资源定时 API，本指南将帮助您理解它们提供的数据。")]),t._v(" "),a("h2",{attrs:{id:"简单的-api-可帮助您了解浏览器中的网络请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简单的-api-可帮助您了解浏览器中的网络请求"}},[t._v("#")]),t._v(" 简单的 API 可帮助您了解浏览器中的网络请求")]),t._v(" "),a("p",[t._v("导航和资源计时相互之间有很大的重叠，但是它们各自收集不同方面的指标：")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://w3c.github.io/navigation-timing/",target:"_blank",rel:"noopener noreferrer"}},[a("strong",[t._v("导航计时")]),a("OutboundLink")],1),t._v("收集 HTML 文档的性能指标。")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://w3c.github.io/resource-timing/",target:"_blank",rel:"noopener noreferrer"}},[a("strong",[t._v("资源计时")]),a("OutboundLink")],1),t._v("收集文档相关资源的性能指标。东西像样式表，脚本，图片，"),a("em",[t._v("等等")]),t._v("。")])]),t._v(" "),a("p",[t._v("如果您对这两个 API 一无所知，您可能会因为过于复杂或不必要而将其清除。事实是，从这些 API 中"),a("em",[t._v("获取")]),t._v("数据很容易，并且该数据对于衡量实际用户的加载性能"),a("em",[t._v("至关重要")]),t._v("。该"),a("em",[t._v("硬")]),t._v("的部分是他们提供的数据的意义，但我们会覆盖所有的很快。现在，让我们在控制台中进行一些实验。")]),t._v(" "),a("p",[t._v("导航和资源计时（以及其他相关 API）将"),a("em",[t._v("性能条目")]),t._v("存储 在"),a("em",[t._v("性能条目缓冲区中")]),t._v("。简单来说，这意味着它们将页面和资源的性能指标存储到 JavaScript 可访问的列表中。这些方法存在于"),a("code",[t._v("window.performance")]),t._v(" 名称空间中，它们以不同的方式帮助我们查询此列表。不过，现在让我们保持简单并坚持使用"),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Performance/getEntriesByType",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("getEntriesByType")]),t._v(" method"),a("OutboundLink")],1),t._v("。首先，在浏览器中加载任何页面，打开控制台，然后输入以下两个命令之一（或两个都输入）：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Get Navigation Timing entries:")]),t._v("\nperformance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getEntriesByType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'navigation'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Get Resource Timing entries:")]),t._v("\nperformance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getEntriesByType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'resource'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[a("code",[t._v("getEntriesByType")]),t._v("接受描述所需条目类型的字符串。要获取导航时间条目，请使用"),a("code",[t._v('"navigation"')]),t._v("。对于资源计时条目，使用"),a("code",[t._v('"resource"')]),t._v("。运行此命令后，您将看到一个数组，其中包含当前页面的性能计时对象，如下所示：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"connectEnd"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("152.20000001136214")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"connectStart"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("85.00000007916242")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"decodedBodySize"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1270")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"domComplete"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("377.90000007953495")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"domContentLoadedEventEnd"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("236.4000000525266")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"domContentLoadedEventStart"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("236.4000000525266")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"domInteractive"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("236.2999999895692")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"domainLookupEnd"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("85.00000007916242")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"domainLookupStart"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64.4000000320375")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"duration"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("377.90000007953495")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"encodedBodySize"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("606")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"entryType"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"navigation"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fetchStart"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("61.600000015459955")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"initiatorType"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"navigation"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"loadEventEnd"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("377.90000007953495")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"loadEventStart"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("377.90000007953495")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://example.com/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nextHopProtocol"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"h2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redirectCount"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redirectEnd"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redirectStart"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"requestStart"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("152.50000008381903")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"responseEnd"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("197.80000008177012")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"responseStart"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("170.00000004190952")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"secureConnectionStart"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("105.80000001937151")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"startTime"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"transferSize"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("789")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"navigate"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"unloadEventEnd"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"unloadEventStart"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"workerStart"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("这些信息的密度可能令人不知所措，但请记住一件事：每当您看到瀑布图时，您都在查看这些 API 提供的数据的直观表示！实际上，可以使用此数据生成自己的视觉效果。例如"),a("a",{attrs:{href:"https://twitter.com/AndyDavies",target:"_blank",rel:"noopener noreferrer"}},[t._v("安迪·戴维斯"),a("OutboundLink")],1),t._v("（"),a("a",{attrs:{href:"https://twitter.com/AndyDavies",target:"_blank",rel:"noopener noreferrer"}},[t._v("Andy Davies）的"),a("OutboundLink")],1),a("a",{attrs:{href:"https://github.com/andydavies/waterfall",target:"_blank",rel:"noopener noreferrer"}},[t._v("Waterfall（瀑布"),a("OutboundLink")],1),a("a",{attrs:{href:"https://twitter.com/AndyDavies",target:"_blank",rel:"noopener noreferrer"}},[t._v("）"),a("OutboundLink")],1),t._v("或 "),a("a",{attrs:{href:"https://twitter.com/micmro",target:"_blank",rel:"noopener noreferrer"}},[t._v("Michael Mrowetz"),a("OutboundLink")],1),t._v("（ "),a("a",{attrs:{href:"https://twitter.com/micmro",target:"_blank",rel:"noopener noreferrer"}},[t._v("Michael Mrowetz）的"),a("OutboundLink")],1),a("a",{attrs:{href:"https://github.com/micmro/performance-bookmarklet",target:"_blank",rel:"noopener noreferrer"}},[t._v("Performance-Bookmarklet"),a("OutboundLink")],1),t._v("等脚本就是很好的例子 。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://developers.google.cn/web/fundamentals/performance/navigation-and-resource-timing/images/figure-1-1x.png",alt:"由安迪·戴维斯（Andy Davies）创建的Waterfall（瀑布）小书签可视化的资源时间列表。"}}),a("strong",[t._v("图 1")]),t._v("。显示页面及其资源计时的 Waterfall 小书签。")]),t._v(" "),a("p",[t._v("导航和资源定时是可以帮助您衡量加载内容所需时间的 API。由于这些 API 是 JavaScript 的一部分，因此您可以使用它们来收集用户访问页面时的重要性能统计信息。那是强大的东西！")]),t._v(" "),a("h2",{attrs:{id:"网络请求的寿命和时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网络请求的寿命和时间"}},[t._v("#")]),t._v(" 网络请求的寿命和时间")]),t._v(" "),a("p",[t._v("当您收集页面导航和资源下载的时间时，您扮演的是考古学家的角色，即您要在事后重建网络请求的短暂生命。有时，它有助于可视化一个概念，并且在涉及网络请求时，没有比浏览器的开发工具更好的可视化工具。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://developers.google.cn/web/fundamentals/performance/navigation-and-resource-timing/images/figure-2-1x.png",alt:"Chrome的开发者工具可视化的网络请求时间列表。"}}),a("strong",[t._v("图 2")]),t._v("。在 Chrome 开发人员工具的网络面板中如何可视化网络请求。")]),t._v(" "),a("p",[t._v("如您所见，此请求具有您期望的所有有趣的东西：DNS 查找，连接，TLS 协商等等。让我们一起来看一下导航和资源定时中的重要（不是那么重要）位，并演示哪些属性和指标可以帮助您衡量对应用程序性能至关重要的活动！让我们开始吧！")]),t._v(" "),a("p",[t._v("**注意：**本指南对哪些指标最重要有些看法。如果您想同时看到这两个 API 的鸟瞰图，并在其中显示确切的订单指标，那么"),a("a",{attrs:{href:"https://www.w3.org/TR/navigation-timing-2/#processing-model",target:"_blank",rel:"noopener noreferrer"}},[t._v("此 Timing 处理模型图"),a("OutboundLink")],1),t._v("将非常有用。")]),t._v(" "),a("h3",{attrs:{id:"dns-查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dns-查询"}},[t._v("#")]),t._v(" DNS 查询")]),t._v(" "),a("p",[t._v("当用户请求 URL 时，将查询域名系统（DNS）以将域转换为 IP 地址。根据许多因素（尤其是 DNS 缓存），此过程可能会花费大量时间。也许不是，但是无论如何，这都是您想要测量的东西。导航和资源计时都公开了两个与 DNS 相关的指标：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("domainLookupStart")]),t._v(" DNS 查找开始时标记。")]),t._v(" "),a("li",[a("code",[t._v("domainLookupEnd")]),t._v(" DNS 查找结束时标记。")])]),t._v(" "),a("p",[t._v("真的很简单！当网络请求阶段是线性的时，测量其持续时间就像从终止度量中减去起始度量一样容易：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Measuring DNS lookup time")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" pageNav "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" performance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getEntriesByType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'navigation'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" dnsTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domainLookupEnd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domainLookupStart\n")])])]),a("p",[t._v("现在有一些坏消息：您不能"),a("em",[t._v("总是")]),t._v("依靠某些指标来填充。这两个 API 中的某些属性将"),a("code",[t._v("0")]),t._v("在特定条件下使用。例如，如果主机未设置适当的 响应头，则"),a("code",[t._v("domainLookupStart")]),t._v("和"),a("code",[t._v("domainLookupEnd")]),t._v("（及其他）都可以"),a("code",[t._v("0")]),t._v("用于第三方提供的资源 "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Timing-Allow-Origin",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("Timing-Allow-Origin")]),a("OutboundLink")],1),t._v("。我们暂时还不会涉足杂草，但是"),a("a",{attrs:{href:"https://developers.google.cn/web/fundamentals/performance/navigation-and-resource-timing#cross-origins_and_the_timing-allow-origin_header",target:"_blank",rel:"noopener noreferrer"}},[t._v("稍后我们会讨论"),a("OutboundLink")],1),t._v("。现在，让我们继续前进。")]),t._v(" "),a("h3",{attrs:{id:"连接协商"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#连接协商"}},[t._v("#")]),t._v(" 连接协商")]),t._v(" "),a("p",[t._v("与服务器建立连接后，由于客户端和服务器在将资源发送到客户端之前先进行整理，因此会发生延迟。如果使用 HTTPS（"),a("a",{attrs:{href:"https://httparchive.org/reports/state-of-the-web#pctHttps",target:"_blank",rel:"noopener noreferrer"}},[t._v("这越来越普遍"),a("OutboundLink")],1),t._v("），则此过程还包括 TLS 协商时间。连接阶段包含三个指标：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("connectStart")]),t._v(" 客户端打开与服务器的连接时标记。")]),t._v(" "),a("li",[a("code",[t._v("secureConnectionStart")]),t._v(" 当客户端开始 TLS 协商时标记。")]),t._v(" "),a("li",[a("code",[t._v("connectEnd")]),t._v(" 在连接协商结束时标记（包括 TLS 时间）。")])]),t._v(" "),a("p",[t._v("这些"),a("em",[t._v("几乎")]),t._v("和 DNS 指标一样简单，但是却"),a("code",[t._v("secureConnectionStart")]),t._v("改变了一切。您可能会问：“为什么没有"),a("code",[t._v("secureConnectionEnd")]),t._v("财产？” 答案是 TLS 协商与协商同时结束"),a("code",[t._v("connectEnd")]),t._v("。如果未使用 HTTPS（或"),a("a",{attrs:{href:"https://en.wikipedia.org/wiki/HTTP_persistent_connection",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTTP 连接仍然存在"),a("OutboundLink")],1),t._v("），则此值为"),a("code",[t._v("0")]),t._v("，因此您需要执行适当的检查，而不是假定始终填充该值：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Quantifying total connection time")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" pageNav "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" performance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getEntriesByType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'navigation'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" connectionTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connectEnd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connectStart\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" tlsTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// <-- Assume 0 by default")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Did any TLS stuff happen?")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("secureConnectionStart "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Awesome! Calculate it!")]),t._v("\n  tlsTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connectEnd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("secureConnectionStart\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("查找域的 IP 并建立连接后，"),a("em",[t._v("真正的")]),t._v("乐趣就开始了。")]),t._v(" "),a("h3",{attrs:{id:"要求和回应"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#要求和回应"}},[t._v("#")]),t._v(" 要求和回应")]),t._v(" "),a("p",[t._v("当我们考虑影响页面速度的因素时，我们正在考虑两个因素：")]),t._v(" "),a("ul",[a("li",[t._v("**外在因素：**这是诸如连接延迟和带宽之类的东西。作为开发人员，他们（大部分）是我们无法控制的。")]),t._v(" "),a("li",[t._v("**内在因素：**这些是我们可以更好地控制的事情，例如服务器和客户端架构以及资源大小。")])]),t._v(" "),a("p",[t._v("两种类型的因素都会影响请求和响应速度。与该过程相关的指标可以说是最重要的指标，因为它们讲述了每种资源花费多长时间的故事。导航和资源定时都使用以下度量来描述请求和响应：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("fetchStart")]),t._v("在浏览器开始获取资源时标记。这与请求不同，因为它不标记浏览器何时对资源发出网络请求，而是标记它何时开始检查缓存（例如 HTTP 和服务工作者缓存）以查看是否甚至需要网络请求。")]),t._v(" "),a("li",[a("code",[t._v("workerStart")]),t._v("在"),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/FetchEvent",target:"_blank",rel:"noopener noreferrer"}},[t._v("事件处理程序"),a("OutboundLink")],1),t._v("（如果适用）中从"),a("a",{attrs:{href:"https://developers.google.cn/web/fundamentals/primers/service-workers",target:"_blank",rel:"noopener noreferrer"}},[t._v("服务工作者"),a("OutboundLink")],1),t._v("获取请求时进行标记。如果当前页面未安装服务人员，则总是这样。"),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/FetchEvent",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("fetch")]),a("OutboundLink")],1),a("code",[t._v("0")])]),t._v(" "),a("li",[a("code",[t._v("requestStart")]),t._v(" 当浏览器发出网络请求时。")]),t._v(" "),a("li",[a("code",[t._v("responseStart")]),t._v(" 是响应的第一个字节到达时。")]),t._v(" "),a("li",[a("code",[t._v("responseEnd")]),t._v(" 是响应的最后一个字节到达的时间。")])]),t._v(" "),a("p",[t._v("您可以使用这些指标来衡量加载性能的许多方面。例如，您可以在考虑缓存查找时间的同时测量资源下载时间：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Cache seek plus response time")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" pageNav "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" performance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getEntriesByType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'navigation'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" fetchTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseEnd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fetchStart\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Service worker time plus response time")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" workerTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("workerStart "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  workerTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseEnd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("workerStart\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("您还可以测量其他有用的东西，如下面的代码所示：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Request time only (excluding unload, redirects, DNS, and connection time)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" requestTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseStart "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("requestStart\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Response time only (download)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" responseTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseEnd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseStart\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Request + response time")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" requestResponseTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseEnd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("requestStart\n")])])]),a("h3",{attrs:{id:"其他的东西"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他的东西"}},[t._v("#")]),t._v(" 其他的东西")]),t._v(" "),a("p",[t._v("现在，我们已经介绍了导航和资源定时提供的最重要的指标，让我们简要地看一下其中一些不太重要的指标。")]),t._v(" "),a("h4",{attrs:{id:"文件卸载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件卸载"}},[t._v("#")]),t._v(" 文件卸载")]),t._v(" "),a("p",[t._v("卸载是指浏览器在加载新页面之前进行一些整理工作。这不是典型的情况下，一个大问题，但它"),a("em",[t._v("可能")]),t._v("是值得定量，如果你有一些代码（特别是第三方）在运行的 "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/Events/unload",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("unload")]),t._v("事件处理程序"),a("OutboundLink")],1),t._v("，从渲染扬起了下一个页面。如果这描述了您的情况，则需要注意 "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/PerformanceNavigationTiming/unloadEventStart",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("unloadEventStart")]),a("OutboundLink")],1),t._v(" 和 "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/PerformanceNavigationTiming/unloadEventEnd",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("unloadEventEnd")]),a("OutboundLink")],1),t._v(" 指标。")]),t._v(" "),a("p",[t._v("**注意：**卸载指标是“导航定时”所独有的。")]),t._v(" "),a("h4",{attrs:{id:"重新导向"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重新导向"}},[t._v("#")]),t._v(" 重新导向")]),t._v(" "),a("p",[t._v("好的，页面重定向并不是"),a("em",[t._v("完全")]),t._v("无关紧要的，但是它们可能不是您经常遇到的问题。重定向仍然会增加请求的延迟，因此对它们进行测量可能是值得的。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://developers.google.cn/web/fundamentals/performance/navigation-and-resource-timing/images/figure-3-1x.png",alt:"在Chrome开发人员工具中可视化的重定向链。"}}),a("strong",[t._v("图 3")]),t._v("。Chrome 开发人员工具中显示的重定向链。")]),t._v(" "),a("p",[t._v("如果您担心重定向，则两个 API 都提供 "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/PerformanceResourceTiming/redirectStart",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("redirectStart")]),a("OutboundLink")],1),t._v(" 和 "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/PerformanceResourceTiming/redirectEnd",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("redirectEnd")]),a("OutboundLink")],1),t._v(" 指标，这使得衡量重定向时间成为一项琐碎的任务。")]),t._v(" "),a("h4",{attrs:{id:"文件处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件处理"}},[t._v("#")]),t._v(" 文件处理")]),t._v(" "),a("p",[t._v("加载 HTML 文档时，浏览器会花一些时间来处理它们。导航计时自曝指标来衡量这一点，但除非它们通常不是间接"),a("em",[t._v("也许")]),t._v("你在提供巨大的文件。如果你有兴趣在文档处理指标，它们是 "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/PerformanceNavigationTiming/domInteractive",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("domInteractive")]),a("OutboundLink")],1),t._v("， "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/PerformanceNavigationTiming/domContentLoadedEventStart",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("domContentLoadedEventStart")]),a("OutboundLink")],1),t._v("， "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/PerformanceNavigationTiming/domContentLoadedEventEnd",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("domContentLoadedEventEnd")]),a("OutboundLink")],1),t._v("，和 "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/PerformanceNavigationTiming/domComplete",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("domComplete")]),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[t._v("**注意：**文档处理指标是“导航定时”所独有的。")]),t._v(" "),a("h4",{attrs:{id:"载入中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#载入中"}},[t._v("#")]),t._v(" 载入中")]),t._v(" "),a("p",[t._v("文档及其资源完全完成加载后，浏览器将触发一个"),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/Events/load",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("load")]),t._v(" 事件"),a("OutboundLink")],1),t._v("。一些人强调加载时间是度量的最高标准，但是 已经发生了重点"),a("a",{attrs:{href:"https://www.stevesouders.com/blog/2013/05/13/moving-beyond-window-onload/",target:"_blank",rel:"noopener noreferrer"}},[t._v("转移，"),a("OutboundLink")],1),t._v("以将感知度量（例如"),a("a",{attrs:{href:"https://sites.google.com/a/webpagetest.org/docs/using-webpagetest/metrics/speed-index",target:"_blank",rel:"noopener noreferrer"}},[t._v("Speed Index"),a("OutboundLink")],1),t._v("）优先于加载时间。")]),t._v(" "),a("p",[t._v("不过，测量加载时间可能对您有所帮助。 "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/PerformanceNavigationTiming/loadEventStart",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("loadEventStart")]),a("OutboundLink")],1),t._v(" 并 "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/PerformanceNavigationTiming/loadEventEnd",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("loadEventEnd")]),a("OutboundLink")],1),t._v(" 可以在文档方面为您提供帮助，但是使用该"),a("code",[t._v("duration")]),t._v("属性可能最简单。")]),t._v(" "),a("p",[t._v("**注意：**和指标是导航计时所独有的。 "),a("code",[t._v("loadEventStart``loadEventEnd")])]),t._v(" "),a("h4",{attrs:{id:"文件和资源大小"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件和资源大小"}},[t._v("#")]),t._v(" 文件和资源大小")]),t._v(" "),a("p",[t._v("文档或资源的"),a("em",[t._v("大小")]),t._v("无疑对加载性能有影响。幸运的是，两个 API 都公开了用于量化资源有效载荷的属性：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("transferSize")]),t._v("是资源的"),a("em",[t._v("总大小")]),t._v("，包括 HTTP 标头。")]),t._v(" "),a("li",[a("code",[t._v("encodedBodySize")]),t._v("是资源的"),a("em",[t._v("压缩大小")]),t._v("，"),a("em",[t._v("不包括")]),t._v(" HTTP 标头。")]),t._v(" "),a("li",[a("code",[t._v("decodedBodySize")]),t._v("是资源的"),a("em",[t._v("解压缩大小")]),t._v("（再次，不包括 HTTP 标头）。")])]),t._v(" "),a("p",[t._v("使用简单的算法，很容易找出响应的多少由 HTTP 标头或什至压缩率组成：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// HTTP header size")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" pageNav "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" performance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getEntriesByType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'navigation'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" headerSize "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("transferSize "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("encodedBodySize\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Compression ratio")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" compressionRatio "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("decodedBodySize "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" pageNav"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("encodedBodySize\n")])])]),a("p",[t._v("您可能已经意识到资源的大小，并且您实际上并不需要 API 来告诉您这些信息，因为任何浏览器的开发工具中的网络面板都可以传达这些信息。但是，如果需要，信息"),a("em",[t._v("就")]),t._v("在那里。")]),t._v(" "),a("h2",{attrs:{id:"在应用程序代码中获取时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在应用程序代码中获取时间"}},[t._v("#")]),t._v(" 在应用程序代码中获取时间")]),t._v(" "),a("p",[t._v("现在您已经知道了这些 API 提供的一些指标，下面让我们介绍如何在应用程序代码中收集这些数据。")]),t._v(" "),a("h3",{attrs:{id:"其他手动获取时间的方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他手动获取时间的方法"}},[t._v("#")]),t._v(" 其他手动获取时间的方法")]),t._v(" "),a("p",[t._v("在本指南的前面，您已经涉足了"),a("code",[t._v("getEntriesByType")]),t._v("，这对于获取特定类型的性能条目非常有用。但是，还有两个其他相关方法值得一提。")]),t._v(" "),a("h4",{attrs:{id:"getentriesbyname"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#getentriesbyname"}},[t._v("#")]),t._v(" "),a("code",[t._v("getEntriesByName")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Performance/getEntriesByName",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("getEntriesByName")]),a("OutboundLink")],1),t._v(" 通过其名称获得一个表演条目。对于导航和资源计时，这是文档或资源的 URL：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Get timing data for an important hero image")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" heroImageTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" performance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getEntriesByName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://somesite.com/images/hero-image.jpg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("如果您需要获取单个资源的性能条目，这将"),a("em",[t._v("非常")]),t._v("有用。与通过其他方式过滤掉数组相比，这也是一种性能更好的替代方法。")]),t._v(" "),a("h4",{attrs:{id:"getentries"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#getentries"}},[t._v("#")]),t._v(" getEntries")]),t._v(" "),a("p",[t._v("与"),a("code",[t._v("getEntriesByName")]),t._v("和不同"),a("code",[t._v("getEntriesByType")]),t._v("，"),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Performance/getEntries",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("getEntries")]),a("OutboundLink")],1),t._v(" 默认情况下， 所有内容都在性能条目缓冲区中获取：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Get timing data for all entries in the performance entry buffer")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" allTheTimings "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" performance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getEntries")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("如果"),a("code",[t._v("initiatorType")]),t._v("您觉得新手，那是因为我在这里没有介绍。 "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/PerformanceResourceTiming/initiatorType",target:"_blank",rel:"noopener noreferrer"}},[t._v("在 MDN "),a("OutboundLink")],1),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/PerformanceResourceTiming/initiatorType",target:"_blank",rel:"noopener noreferrer"}},[t._v("了解更多信息"),a("code",[t._v("initiatorType")]),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"使用-performanceobserver-收听性能条目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-performanceobserver-收听性能条目"}},[t._v("#")]),t._v(" 使用 PerformanceObserver 收听性能条目")]),t._v(" "),a("p",[t._v("因为像"),a("code",[t._v("getEntriesByType")]),t._v("返回数组这样的方法，您可能很想使用循环来处理它们并说“足够好”，但是由于以下原因，这种方法存在问题：")]),t._v(" "),a("ul",[a("li",[t._v("循环（尤其是在具有许多条目的数组上）占用了主线程。")]),t._v(" "),a("li",[t._v("循环仅捕获运行循环时可用的性能条目。通过计时器定期轮询性能条目缓冲区非常昂贵，并且会与渲染器竞争，这可能会导致垃圾邮件。")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://developers.google.cn/web/updates/2016/06/performance-observer",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("PerformanceObserver")]),a("OutboundLink")],1),t._v("旨在解决此类烦恼。使用类似于"),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mutation"),a("OutboundLink")],1),t._v("或 "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/IntersectionObserver",target:"_blank",rel:"noopener noreferrer"}},[t._v("Intersection Observer"),a("OutboundLink")],1),t._v("的观察者模式 ，您可以分配一个回调，该回调在记录新的性能条目时运行：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Instantiate the performance observer")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" perfObserver "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PerformanceObserver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" obj")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Get all the resource entries collected so far")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// (You can also use getEntriesByType/getEntriesByName here)")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" entries "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getEntries")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Iterate over entries")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" entries"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Do the work!")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Run the observer")]),t._v("\nperfObserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("observe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Polls for Navigation and Resource Timing entries")]),t._v("\n  entryTypes"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'navigation'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'resource'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("如果您没有与观察员的经验，这种模式最初可能会感到尴尬，但很快就会成为第二天性。明智的选择： "),a("code",[t._v("PerformanceObserver")]),t._v("并非在所有浏览器中都可用，导航和资源定时都可用！实际上，Internet Explorer 和 Edge 都不支持 "),a("code",[t._v("PerformanceObserver")]),t._v("，因此请进行功能检查以避免怪异：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Should we even be doing anything with perf APIs?")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'performance'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// OK, yes. Check PerformanceObserver support")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PerformanceObserver'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Observe ALL the performance entries!")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// WOMP WOMP. Find another way. Or not.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("使用这样的代码，您可以自己决定如何收集性能计时（如果有的话）。您可能会决定，如果"),a("code",[t._v("PerformanceObserver")]),t._v("没有收集时间，则不值得为此烦恼。这完全取决于您！")]),t._v(" "),a("h3",{attrs:{id:"陷阱"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#陷阱"}},[t._v("#")]),t._v(" 陷阱")]),t._v(" "),a("p",[t._v("使用计时并非总是那么简单。您可能还记得过，我们提出了如何在某些情况下以您期望的方式填充某些时间安排，以及可能存在其他棘手的情况。")]),t._v(" "),a("h4",{attrs:{id:"跨域和-timing-allow-origin-标头"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域和-timing-allow-origin-标头"}},[t._v("#")]),t._v(" 跨域和 Timing-Allow-Origin 标头")]),t._v(" "),a("p",[t._v("收集跨域资源的指标很奇怪，因为如果 未设置"),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Timing-Allow-Origin",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("Timing-Allow-Origin")]),t._v(" 标头，"),a("OutboundLink")],1),t._v("则并非所有性能计时都可以访问。要了解哪些指标受此影响，请查看“资源时序”规范的"),a("a",{attrs:{href:"https://www.w3.org/TR/resource-timing-2/#cross-origin-resources",target:"_blank",rel:"noopener noreferrer"}},[t._v("这一部分"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[t._v("如果您在多个域上运行应用程序，或者将公共资产作为第三方提供，则应设置适当的"),a("code",[t._v("Timing-Allow-Origin")]),t._v("标头，以便开发人员可以捕获托管在它们上的资源的时间安排。查看"),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Timing-Allow-Origin",target:"_blank",rel:"noopener noreferrer"}},[t._v("MDN 文档 "),a("code",[t._v("Timing-Allow-Origin")]),a("OutboundLink")],1),t._v(" 以了解更多信息。")]),t._v(" "),a("h4",{attrs:{id:"持续的连接会影响时序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#持续的连接会影响时序"}},[t._v("#")]),t._v(" 持续的连接会影响时序")]),t._v(" "),a("p",[t._v("持久 HTTP 连接是指重新使用连接以传输其他资源时。使用"),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Keep-Alive",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("Connection: Keep-Alive")]),t._v(" 标头"),a("OutboundLink")],1),t._v("时，这会在 HTTP / 1 中发生。通过 HTTP / 2 提供内容时，将使用单个连接流式传输 该源的"),a("em",[t._v("所有")]),t._v("资源。此行为会影响时间。您不必显式地检查它，而稍后使用度量时则需要注意。")]),t._v(" "),a("h4",{attrs:{id:"这些-api-并非随处可用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#这些-api-并非随处可用"}},[t._v("#")]),t._v(" 这些 API 并非随处可用")]),t._v(" "),a("p",[t._v("如果在网络上工作可以教给您任何知识，那就是您不能依赖于随处可用的 API。导航和资源定时也是如此。像这样的方法最大的优点"),a("code",[t._v("getEntriesByType")]),t._v("是，如果有可用的方法，则找不到任何东西也不会抛出错误。")]),t._v(" "),a("p",[t._v("一切都很好，但这可能会引起一些混乱。在 Safari 的奇怪情况下（从 11.2 版开始），支持资源定时，但不支持导航定时。这导致如下情况：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// This returns stuff!")]),t._v("\nperformance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getEntriesByType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'resource'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Not so much. :\\")]),t._v("\nperformance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getEntriesByType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'navigation'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("虽然这很痛苦，但这不是世界末日。使用这些方法获取条目时，只需检查是否返回了任何内容：")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("performance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getEntriesByType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'navigation'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Yay, we have Navigation Timing stuff!")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("无论浏览器是否支持这些 API，这都是一项明智的选择。您永远不要对可用数据进行假设，因为在某些情况下，假设可能适得其反。")]),t._v(" "),a("h2",{attrs:{id:"给家里打电话"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#给家里打电话"}},[t._v("#")]),t._v(" 给家里打电话")]),t._v(" "),a("p",[t._v("因此，我们现在知道如何使用这些 API 并从它们中获取数据，但是如何将这些数据获取到可以使用它们的地方？尽管这绝不是 RUM 数据收集的详尽参考，但它是一个起点。")]),t._v(" "),a("h3",{attrs:{id:"使用-navigator-sendbeacon"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-navigator-sendbeacon"}},[t._v("#")]),t._v(" 使用 "),a("code",[t._v("navigator.sendBeacon")])]),t._v(" "),a("p",[t._v("您已经收集了性能条目，现在可以将它们发送到某个地方以供以后分析了。但是最好的方法是什么？")]),t._v(" "),a("p",[t._v("诸如"),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Navigator/sendBeacon",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("navigator.sendBeacon")]),a("OutboundLink")],1),t._v(" （或更近期的"),a("a",{attrs:{href:"https://www.chromestatus.com/feature/5760375567941632",target:"_blank",rel:"noopener noreferrer"}},[t._v("获取"),a("code",[t._v("keepalive")]),t._v(" 标志"),a("OutboundLink")],1),t._v("）之类的 API 可以以非阻塞方式发送请求，这对于 RUM 分析或不需要等待响应的其他类型的请求非常理想。")]),t._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Caution: If you have a _lot_ of performance entries, don't send _everything_ via getEntries. This is just an example.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" rumData "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("performance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getEntries")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Check for sendBeacon support:")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sendBeacon'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" navigator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Beacon the requested")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("navigator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendBeacon")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/analytics'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" rumData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// sendBeacon worked! We're good!")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// sendBeacon failed! Use XHR or fetch instead")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// sendBeacon not available! Use XHR or fetch instead")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("在另一端将是一些后端代码，这些代码查看 POST 表单数据并从那里决定如何处理它。如何执行此操作取决于您的应用程序后端。")]),t._v(" "),a("p",[t._v("**注意：**仅在调用时将请求"),a("em",[t._v("排队")]),t._v("，而不能立即完成。另外，用户代理对可以发送多少数据施加了限制，并且如果超出该限制，则可以拒绝该请求。 "),a("code",[t._v("navigator.sendBeacon")])]),t._v(" "),a("h2",{attrs:{id:"包起来"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#包起来"}},[t._v("#")]),t._v(" 包起来")]),t._v(" "),a("p",[t._v("总结一下，这里有一些自以为是的观点：如果您不确定这些计时的工作方式，请不要在前端计算指标，而将计算的数据发送到后端。存储原始指标，以后再使用。出于多种原因，这是有优势的，但主要是因为它很灵活。如果存储原始指标，则以后总是可以在出现测量错误时进行更正。")]),t._v(" "),a("p",[t._v("最后，您不需要存储这些 API 提供的"),a("em",[t._v("每个")]),t._v("指标。例如，如果你知道一个事实，你不需要来衡量 DOM 处理时间，不觉得你"),a("em",[t._v("有")]),t._v("来存储这些指标。")]),t._v(" "),a("p",[t._v("当然，本指南并不是要成为这些 API 的详尽资源，而是要帮助您放心使用它们。如果您想要有关此主题的其他观点，请阅读以下其他内容：")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.w3.org/TR/navigation-timing-2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("导航计时 2 级规格"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.w3.org/TR/resource-timing-2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("资源时序 2 级规范。"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://developers.google.cn/web/tools/chrome-devtools/network-performance/understanding-resource-timing",target:"_blank",rel:"noopener noreferrer"}},[t._v("了解资源计时。"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://nicj.net/resourcetiming-in-practice/",target:"_blank",rel:"noopener noreferrer"}},[t._v("实践中的资源计时。"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://community.akamai.com/community/web-performance/blog/2016/08/25/using-navigation-timing-apis-to-understand-your-webpage",target:"_blank",rel:"noopener noreferrer"}},[t._v("使用导航计时 API 来了解您的网页。"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("即使您通常避开深入的技术性阅读，对于导航和资源时序的官方规范也很容易理解。他们还以一种非常有益的方式打破了陷阱。如果你问自己“当问题"),a("em",[t._v("是")]),t._v(" "),a("code",[t._v("secureConnectionStart")]),t._v(" "),a("code",[t._v("0")]),t._v("？”，规格说明一切怪事相当不错。")]),t._v(" "),a("p",[t._v("使用这些 API，您将可以更好地了解实际用户如何体验加载性能。这意味着您将有能力更好地诊断和解决野外性能问题，并且该知识真正强大。")]),t._v(" "),a("p",[a("em",[t._v("特别感谢"),a("a",{attrs:{href:"https://developers.google.cn/web/resources/contributors/paulirish",target:"_blank",rel:"noopener noreferrer"}},[t._v("Paul Irish"),a("OutboundLink")],1),t._v("，Gray Norton，"),a("a",{attrs:{href:"https://developers.google.cn/web/resources/contributors/addyosmani",target:"_blank",rel:"noopener noreferrer"}},[t._v("Addy Osmani"),a("OutboundLink")],1),t._v("和"),a("a",{attrs:{href:"https://developers.google.cn/web/resources/contributors/philipwalton",target:"_blank",rel:"noopener noreferrer"}},[t._v("Philip Walton"),a("OutboundLink")],1),t._v("的宝贵反馈，这些反馈显着提高了本文的质量。")])])])}),[],!1,null,null,null);e.default=s.exports}}]);