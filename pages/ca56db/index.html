<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第9章 客户端检测 | LiYang&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css">
    <meta name="description" content="web前端技术博客,简洁至上,专注web前端学习与总结。JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github等技术文章。">
    <link rel="preload" href="/assets/css/0.styles.ff3929f5.css" as="style"><link rel="preload" href="/assets/js/app.40794b05.js" as="script"><link rel="preload" href="/assets/js/2.21c2c3d2.js" as="script"><link rel="preload" href="/assets/js/185.1b24284f.js" as="script"><link rel="prefetch" href="/assets/js/10.058f7072.js"><link rel="prefetch" href="/assets/js/100.f3568421.js"><link rel="prefetch" href="/assets/js/101.3669cd11.js"><link rel="prefetch" href="/assets/js/102.cefa1450.js"><link rel="prefetch" href="/assets/js/103.0fc12baa.js"><link rel="prefetch" href="/assets/js/104.fc75b27c.js"><link rel="prefetch" href="/assets/js/105.9efa40da.js"><link rel="prefetch" href="/assets/js/106.2132845c.js"><link rel="prefetch" href="/assets/js/107.50efbf3f.js"><link rel="prefetch" href="/assets/js/108.2e4d6b56.js"><link rel="prefetch" href="/assets/js/109.362f4964.js"><link rel="prefetch" href="/assets/js/11.acbb83b6.js"><link rel="prefetch" href="/assets/js/110.260ecf9d.js"><link rel="prefetch" href="/assets/js/111.ac0ed6b0.js"><link rel="prefetch" href="/assets/js/112.e26ce83f.js"><link rel="prefetch" href="/assets/js/113.c17594f4.js"><link rel="prefetch" href="/assets/js/114.081ea0e8.js"><link rel="prefetch" href="/assets/js/115.9f1c1fc5.js"><link rel="prefetch" href="/assets/js/116.300e5c32.js"><link rel="prefetch" href="/assets/js/117.005796a9.js"><link rel="prefetch" href="/assets/js/118.5dd34410.js"><link rel="prefetch" href="/assets/js/119.2a52edee.js"><link rel="prefetch" href="/assets/js/12.f5d0a92b.js"><link rel="prefetch" href="/assets/js/120.2692504f.js"><link rel="prefetch" href="/assets/js/121.de91fbab.js"><link rel="prefetch" href="/assets/js/122.8fe54cb7.js"><link rel="prefetch" href="/assets/js/123.27f7de3d.js"><link rel="prefetch" href="/assets/js/124.df486141.js"><link rel="prefetch" href="/assets/js/125.b3333a19.js"><link rel="prefetch" href="/assets/js/126.0252235d.js"><link rel="prefetch" href="/assets/js/127.e416e0cb.js"><link rel="prefetch" href="/assets/js/128.80fc9ce8.js"><link rel="prefetch" href="/assets/js/129.d549459c.js"><link rel="prefetch" href="/assets/js/13.c75b92e4.js"><link rel="prefetch" href="/assets/js/130.535fd734.js"><link rel="prefetch" href="/assets/js/131.9d165e98.js"><link rel="prefetch" href="/assets/js/132.ef795834.js"><link rel="prefetch" href="/assets/js/133.2044b8d2.js"><link rel="prefetch" href="/assets/js/134.ea0aee7d.js"><link rel="prefetch" href="/assets/js/135.6f39d3e5.js"><link rel="prefetch" href="/assets/js/136.47dc0812.js"><link rel="prefetch" href="/assets/js/137.3eaf9788.js"><link rel="prefetch" href="/assets/js/138.1135d0ed.js"><link rel="prefetch" href="/assets/js/139.d546d7cb.js"><link rel="prefetch" href="/assets/js/14.1114043e.js"><link rel="prefetch" href="/assets/js/140.aae58cac.js"><link rel="prefetch" href="/assets/js/141.b8b72927.js"><link rel="prefetch" href="/assets/js/142.b161cba1.js"><link rel="prefetch" href="/assets/js/143.cfb7b204.js"><link rel="prefetch" href="/assets/js/144.818c2cff.js"><link rel="prefetch" href="/assets/js/145.60f90c39.js"><link rel="prefetch" href="/assets/js/146.7ddef663.js"><link rel="prefetch" href="/assets/js/147.06d1017e.js"><link rel="prefetch" href="/assets/js/148.c7c411a0.js"><link rel="prefetch" href="/assets/js/149.334bd804.js"><link rel="prefetch" href="/assets/js/15.3f0b462f.js"><link rel="prefetch" href="/assets/js/150.7c8c73b7.js"><link rel="prefetch" href="/assets/js/151.62d10d6c.js"><link rel="prefetch" href="/assets/js/152.82e28168.js"><link rel="prefetch" href="/assets/js/153.e1ee4321.js"><link rel="prefetch" href="/assets/js/154.f576cc10.js"><link rel="prefetch" href="/assets/js/155.964a90f2.js"><link rel="prefetch" href="/assets/js/156.4bdc75f5.js"><link rel="prefetch" href="/assets/js/157.6581cb30.js"><link rel="prefetch" href="/assets/js/158.24f9817a.js"><link rel="prefetch" href="/assets/js/159.89915418.js"><link rel="prefetch" href="/assets/js/16.d8001a48.js"><link rel="prefetch" href="/assets/js/160.643f5b36.js"><link rel="prefetch" href="/assets/js/161.4714f73e.js"><link rel="prefetch" href="/assets/js/162.7527446c.js"><link rel="prefetch" href="/assets/js/163.229f891d.js"><link rel="prefetch" href="/assets/js/164.429d3070.js"><link rel="prefetch" href="/assets/js/165.5e342261.js"><link rel="prefetch" href="/assets/js/166.f0cb088a.js"><link rel="prefetch" href="/assets/js/167.40a0038b.js"><link rel="prefetch" href="/assets/js/168.758c8238.js"><link rel="prefetch" href="/assets/js/169.a972a570.js"><link rel="prefetch" href="/assets/js/17.8a850ded.js"><link rel="prefetch" href="/assets/js/170.0fba2db3.js"><link rel="prefetch" href="/assets/js/171.43f66f94.js"><link rel="prefetch" href="/assets/js/172.9467deb8.js"><link rel="prefetch" href="/assets/js/173.26fef872.js"><link rel="prefetch" href="/assets/js/174.0958a150.js"><link rel="prefetch" href="/assets/js/175.a87b0ab5.js"><link rel="prefetch" href="/assets/js/176.04363b06.js"><link rel="prefetch" href="/assets/js/177.34672e1c.js"><link rel="prefetch" href="/assets/js/178.42e0456b.js"><link rel="prefetch" href="/assets/js/179.ec648519.js"><link rel="prefetch" href="/assets/js/18.fe4d545b.js"><link rel="prefetch" href="/assets/js/180.8a5fc825.js"><link rel="prefetch" href="/assets/js/181.3dabf704.js"><link rel="prefetch" href="/assets/js/182.e1193960.js"><link rel="prefetch" href="/assets/js/183.975cb0ee.js"><link rel="prefetch" href="/assets/js/184.a0e65b8e.js"><link rel="prefetch" href="/assets/js/186.9f5186d0.js"><link rel="prefetch" href="/assets/js/187.7b2b6fb4.js"><link rel="prefetch" href="/assets/js/188.39449f6c.js"><link rel="prefetch" href="/assets/js/189.d6c034d8.js"><link rel="prefetch" href="/assets/js/19.48cc10f6.js"><link rel="prefetch" href="/assets/js/190.2fe5508a.js"><link rel="prefetch" href="/assets/js/191.368805e9.js"><link rel="prefetch" href="/assets/js/192.8351a6ec.js"><link rel="prefetch" href="/assets/js/193.4d86bf98.js"><link rel="prefetch" href="/assets/js/194.86d3a829.js"><link rel="prefetch" href="/assets/js/195.931ce7ef.js"><link rel="prefetch" href="/assets/js/196.35818a22.js"><link rel="prefetch" href="/assets/js/197.109eef6d.js"><link rel="prefetch" href="/assets/js/198.a092c6d3.js"><link rel="prefetch" href="/assets/js/199.0a7aea6b.js"><link rel="prefetch" href="/assets/js/20.1baf39d0.js"><link rel="prefetch" href="/assets/js/200.eb75a43c.js"><link rel="prefetch" href="/assets/js/201.167f1a27.js"><link rel="prefetch" href="/assets/js/202.80380232.js"><link rel="prefetch" href="/assets/js/203.dfb07860.js"><link rel="prefetch" href="/assets/js/204.0de5d7ad.js"><link rel="prefetch" href="/assets/js/205.da83ee83.js"><link rel="prefetch" href="/assets/js/206.4ff75723.js"><link rel="prefetch" href="/assets/js/207.c0023a8f.js"><link rel="prefetch" href="/assets/js/208.e1d257d1.js"><link rel="prefetch" href="/assets/js/209.668018f6.js"><link rel="prefetch" href="/assets/js/21.b0e0d339.js"><link rel="prefetch" href="/assets/js/210.eac594b9.js"><link rel="prefetch" href="/assets/js/211.1cc3154f.js"><link rel="prefetch" href="/assets/js/212.0a3e0704.js"><link rel="prefetch" href="/assets/js/213.e5257a7e.js"><link rel="prefetch" href="/assets/js/214.a335e108.js"><link rel="prefetch" href="/assets/js/215.0422f8a3.js"><link rel="prefetch" href="/assets/js/216.6e63fc29.js"><link rel="prefetch" href="/assets/js/217.a38e1ca8.js"><link rel="prefetch" href="/assets/js/218.04c38c96.js"><link rel="prefetch" href="/assets/js/219.89a7899f.js"><link rel="prefetch" href="/assets/js/22.f5c6b71f.js"><link rel="prefetch" href="/assets/js/220.02a01cb8.js"><link rel="prefetch" href="/assets/js/221.e0eded2d.js"><link rel="prefetch" href="/assets/js/222.06c16e31.js"><link rel="prefetch" href="/assets/js/223.a4b75ccb.js"><link rel="prefetch" href="/assets/js/224.9129f3cf.js"><link rel="prefetch" href="/assets/js/225.1c089563.js"><link rel="prefetch" href="/assets/js/226.8d7ae032.js"><link rel="prefetch" href="/assets/js/227.3bfa4328.js"><link rel="prefetch" href="/assets/js/228.a1748bdf.js"><link rel="prefetch" href="/assets/js/229.c1c27996.js"><link rel="prefetch" href="/assets/js/23.265953eb.js"><link rel="prefetch" href="/assets/js/230.f39a1f48.js"><link rel="prefetch" href="/assets/js/231.ca132071.js"><link rel="prefetch" href="/assets/js/232.9ca5e931.js"><link rel="prefetch" href="/assets/js/233.e04e254f.js"><link rel="prefetch" href="/assets/js/234.22381aab.js"><link rel="prefetch" href="/assets/js/235.6bc8508d.js"><link rel="prefetch" href="/assets/js/236.5914c9a6.js"><link rel="prefetch" href="/assets/js/237.a721ad82.js"><link rel="prefetch" href="/assets/js/238.af3e025d.js"><link rel="prefetch" href="/assets/js/239.44fe29c9.js"><link rel="prefetch" href="/assets/js/24.16fb3de9.js"><link rel="prefetch" href="/assets/js/240.9ba57538.js"><link rel="prefetch" href="/assets/js/241.46a9cb7e.js"><link rel="prefetch" href="/assets/js/242.ae70539b.js"><link rel="prefetch" href="/assets/js/243.8a1feaf8.js"><link rel="prefetch" href="/assets/js/244.cdbaaca6.js"><link rel="prefetch" href="/assets/js/245.7117eda6.js"><link rel="prefetch" href="/assets/js/246.742dd686.js"><link rel="prefetch" href="/assets/js/247.7046d3e0.js"><link rel="prefetch" href="/assets/js/248.dbd8407d.js"><link rel="prefetch" href="/assets/js/249.206b660b.js"><link rel="prefetch" href="/assets/js/25.21d0c0dd.js"><link rel="prefetch" href="/assets/js/250.f559b400.js"><link rel="prefetch" href="/assets/js/251.f13bd91c.js"><link rel="prefetch" href="/assets/js/252.aaa10b65.js"><link rel="prefetch" href="/assets/js/253.78640ae7.js"><link rel="prefetch" href="/assets/js/254.5251f555.js"><link rel="prefetch" href="/assets/js/255.5f8655e1.js"><link rel="prefetch" href="/assets/js/256.0b1da59b.js"><link rel="prefetch" href="/assets/js/257.c4b311d3.js"><link rel="prefetch" href="/assets/js/258.62c44f28.js"><link rel="prefetch" href="/assets/js/259.7a8ecb77.js"><link rel="prefetch" href="/assets/js/26.68bfb3cd.js"><link rel="prefetch" href="/assets/js/260.9506bc77.js"><link rel="prefetch" href="/assets/js/261.ab6ac9b0.js"><link rel="prefetch" href="/assets/js/262.6f237036.js"><link rel="prefetch" href="/assets/js/27.e08c2734.js"><link rel="prefetch" href="/assets/js/28.d05f086f.js"><link rel="prefetch" href="/assets/js/29.14bacba0.js"><link rel="prefetch" href="/assets/js/3.9859aeed.js"><link rel="prefetch" href="/assets/js/30.d1c1c795.js"><link rel="prefetch" href="/assets/js/31.c464fa16.js"><link rel="prefetch" href="/assets/js/32.74ae82b3.js"><link rel="prefetch" href="/assets/js/33.6d39a197.js"><link rel="prefetch" href="/assets/js/34.a5448e75.js"><link rel="prefetch" href="/assets/js/35.e677db99.js"><link rel="prefetch" href="/assets/js/36.9373382d.js"><link rel="prefetch" href="/assets/js/37.aaef6158.js"><link rel="prefetch" href="/assets/js/38.b8534a41.js"><link rel="prefetch" href="/assets/js/39.8e5ecefa.js"><link rel="prefetch" href="/assets/js/4.b3a2afa1.js"><link rel="prefetch" href="/assets/js/40.0fbf1e24.js"><link rel="prefetch" href="/assets/js/41.b68829b1.js"><link rel="prefetch" href="/assets/js/42.c6327e05.js"><link rel="prefetch" href="/assets/js/43.5cdcb8f5.js"><link rel="prefetch" href="/assets/js/44.48fd0994.js"><link rel="prefetch" href="/assets/js/45.45e8d731.js"><link rel="prefetch" href="/assets/js/46.ea182d63.js"><link rel="prefetch" href="/assets/js/47.3d1bf5d3.js"><link rel="prefetch" href="/assets/js/48.485f3e01.js"><link rel="prefetch" href="/assets/js/49.a2622af2.js"><link rel="prefetch" href="/assets/js/5.ddbdceff.js"><link rel="prefetch" href="/assets/js/50.572052eb.js"><link rel="prefetch" href="/assets/js/51.ed257c0f.js"><link rel="prefetch" href="/assets/js/52.23b18f3a.js"><link rel="prefetch" href="/assets/js/53.14b56cb4.js"><link rel="prefetch" href="/assets/js/54.bb07175e.js"><link rel="prefetch" href="/assets/js/55.d48bde66.js"><link rel="prefetch" href="/assets/js/56.38433979.js"><link rel="prefetch" href="/assets/js/57.99b13154.js"><link rel="prefetch" href="/assets/js/58.498c71ad.js"><link rel="prefetch" href="/assets/js/59.24e06284.js"><link rel="prefetch" href="/assets/js/6.cae33779.js"><link rel="prefetch" href="/assets/js/60.fe0260d5.js"><link rel="prefetch" href="/assets/js/61.b5bcfd89.js"><link rel="prefetch" href="/assets/js/62.bdc41a00.js"><link rel="prefetch" href="/assets/js/63.10468463.js"><link rel="prefetch" href="/assets/js/64.028e0281.js"><link rel="prefetch" href="/assets/js/65.f762d4ff.js"><link rel="prefetch" href="/assets/js/66.33239ba5.js"><link rel="prefetch" href="/assets/js/67.c89232f4.js"><link rel="prefetch" href="/assets/js/68.e2ab181e.js"><link rel="prefetch" href="/assets/js/69.86594af5.js"><link rel="prefetch" href="/assets/js/7.5bd7e1fe.js"><link rel="prefetch" href="/assets/js/70.f79bf73b.js"><link rel="prefetch" href="/assets/js/71.36d10bfe.js"><link rel="prefetch" href="/assets/js/72.85d3c063.js"><link rel="prefetch" href="/assets/js/73.4746e647.js"><link rel="prefetch" href="/assets/js/74.c8d81312.js"><link rel="prefetch" href="/assets/js/75.dd1ae94f.js"><link rel="prefetch" href="/assets/js/76.b06cc20c.js"><link rel="prefetch" href="/assets/js/77.855f7650.js"><link rel="prefetch" href="/assets/js/78.4e5b0253.js"><link rel="prefetch" href="/assets/js/79.95567ab3.js"><link rel="prefetch" href="/assets/js/8.62836d81.js"><link rel="prefetch" href="/assets/js/80.7b7033a0.js"><link rel="prefetch" href="/assets/js/81.45b93100.js"><link rel="prefetch" href="/assets/js/82.36d8eb8a.js"><link rel="prefetch" href="/assets/js/83.b361b85d.js"><link rel="prefetch" href="/assets/js/84.2e4874fa.js"><link rel="prefetch" href="/assets/js/85.272cfc57.js"><link rel="prefetch" href="/assets/js/86.aaa56439.js"><link rel="prefetch" href="/assets/js/87.dc9e3259.js"><link rel="prefetch" href="/assets/js/88.689b6a8b.js"><link rel="prefetch" href="/assets/js/89.f22e017d.js"><link rel="prefetch" href="/assets/js/9.584f1ef6.js"><link rel="prefetch" href="/assets/js/90.d0ed3f12.js"><link rel="prefetch" href="/assets/js/91.21868b2f.js"><link rel="prefetch" href="/assets/js/92.0b1bc56b.js"><link rel="prefetch" href="/assets/js/93.9fd7ccef.js"><link rel="prefetch" href="/assets/js/94.5cee5367.js"><link rel="prefetch" href="/assets/js/95.c81773d8.js"><link rel="prefetch" href="/assets/js/96.c8f61d95.js"><link rel="prefetch" href="/assets/js/97.f86ea530.js"><link rel="prefetch" href="/assets/js/98.09c0fa30.js"><link rel="prefetch" href="/assets/js/99.c4bd6444.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ff3929f5.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.svg" alt="LiYang's blog" class="logo"> <span class="site-name can-hide">LiYang's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/pages/0a6679/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/0a6679/" class="nav-link">编程基础</a></li><li class="dropdown-item"><!----> <a href="/pages/714859/" class="nav-link">开发软件</a></li><li class="dropdown-item"><!----> <a href="/pages/690ae0/" class="nav-link">类库框架</a></li><li class="dropdown-item"><!----> <a href="/pages/d2dd63/" class="nav-link">知识进阶</a></li><li class="dropdown-item"><!----> <a href="/pages/fd695e/" class="nav-link">工程开发</a></li><li class="dropdown-item"><!----> <a href="/pages/f37132/" class="nav-link">编程思想</a></li><li class="dropdown-item"><!----> <a href="/pages/73d90e/" class="nav-link">领域分支</a></li><li class="dropdown-item"><!----> <a href="/pages/b7eb61/" class="nav-link">社区发展</a></li><li class="dropdown-item"><!----> <a href="/pages/83b440/" class="nav-link">计算机基础</a></li><li class="dropdown-item"><!----> <a href="/pages/0d54d7/" class="nav-link">后端知识</a></li><li class="dropdown-item"><!----> <a href="/pages/416bc0/" class="nav-link">软技能</a></li></ul></div></div><div class="nav-item"><a href="/leetCode/" class="nav-link">🤡LeetCode</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记本" class="dropdown-title"><a href="/notes/" class="link-title">笔记本</a> <span class="title" style="display:none;">笔记本</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>书籍</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/books/es6/" class="nav-link">《ES6教程》</a></li><li class="dropdown-subitem"><a href="/books/professionalJs/" class="nav-link">《JavaScript高级程序设计》</a></li></ul></li><li class="dropdown-item"><h4>教程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/course/css3-jspang/" class="nav-link">CSS3(技术胖)</a></li><li class="dropdown-subitem"><a href="/course/es6-jspang/" class="nav-link">ES6(技术胖)</a></li><li class="dropdown-subitem"><a href="/course/performance/" class="nav-link">性能(Google Developers)</a></li></ul></li><li class="dropdown-item"><h4>技术文档</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/ca56db/.html" class="nav-link">leaflet中文教程</a></li></ul></li></ul></div></div> <a href="https://github.com/fineliving" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/xugaoyi/image_store/blog/20200103123203.jpg"> <div class="blogger-info"><h3>Evan Xu</h3> <span>前端界的小学生</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/categories/" class="nav-link">分类</a></div><div class="nav-item"><a href="/tags/" class="nav-link">标签</a></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/pages/0a6679/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/0a6679/" class="nav-link">编程基础</a></li><li class="dropdown-item"><!----> <a href="/pages/714859/" class="nav-link">开发软件</a></li><li class="dropdown-item"><!----> <a href="/pages/690ae0/" class="nav-link">类库框架</a></li><li class="dropdown-item"><!----> <a href="/pages/d2dd63/" class="nav-link">知识进阶</a></li><li class="dropdown-item"><!----> <a href="/pages/fd695e/" class="nav-link">工程开发</a></li><li class="dropdown-item"><!----> <a href="/pages/f37132/" class="nav-link">编程思想</a></li><li class="dropdown-item"><!----> <a href="/pages/73d90e/" class="nav-link">领域分支</a></li><li class="dropdown-item"><!----> <a href="/pages/b7eb61/" class="nav-link">社区发展</a></li><li class="dropdown-item"><!----> <a href="/pages/83b440/" class="nav-link">计算机基础</a></li><li class="dropdown-item"><!----> <a href="/pages/0d54d7/" class="nav-link">后端知识</a></li><li class="dropdown-item"><!----> <a href="/pages/416bc0/" class="nav-link">软技能</a></li></ul></div></div><div class="nav-item"><a href="/leetCode/" class="nav-link">🤡LeetCode</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="笔记本" class="dropdown-title"><a href="/notes/" class="link-title">笔记本</a> <span class="title" style="display:none;">笔记本</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>书籍</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/books/es6/" class="nav-link">《ES6教程》</a></li><li class="dropdown-subitem"><a href="/books/professionalJs/" class="nav-link">《JavaScript高级程序设计》</a></li></ul></li><li class="dropdown-item"><h4>教程</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/course/css3-jspang/" class="nav-link">CSS3(技术胖)</a></li><li class="dropdown-subitem"><a href="/course/es6-jspang/" class="nav-link">ES6(技术胖)</a></li><li class="dropdown-subitem"><a href="/course/performance/" class="nav-link">性能(Google Developers)</a></li></ul></li><li class="dropdown-item"><h4>技术文档</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/ca56db/.html" class="nav-link">leaflet中文教程</a></li></ul></li></ul></div></div> <a href="https://github.com/fineliving" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/pages/62e671/" class="sidebar-link">什么是JavaScript</a></li><li><a href="/pages/ba2d08/" class="sidebar-link">HTML中的JavaScript</a></li><li><a href="/pages/14fe49/" class="sidebar-link">第3章 基本概念</a></li><li><a href="/pages/6906b5/" class="sidebar-link">第4章 变量、作用域和内存问题</a></li><li><a href="/pages/a7e35f/" class="sidebar-link">第5章 引用类型</a></li><li><a href="/pages/1b466b/" class="sidebar-link">第6章 面向对象的程序设计</a></li><li><a href="/pages/0e90f4/" class="sidebar-link">第7章 函数表达式</a></li><li><a href="/pages/df56f8/" class="sidebar-link">第8章 BOM</a></li><li><a href="/pages/ca56db/" aria-current="page" class="active sidebar-link">第9章 客户端检测</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/ca56db/#_9-1-能力检测" class="sidebar-link">9.1 能力检测</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/ca56db/#_9-1-1-更可靠的能力检测" class="sidebar-link">9.1.1 更可靠的能力检测</a></li><li class="sidebar-sub-header"><a href="/pages/ca56db/#_9-1-2-能力检测-不是浏览器检测" class="sidebar-link">9.1.2 能力检测，不是浏览器检测</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/ca56db/#_9-2-怪癖检测" class="sidebar-link">9.2 怪癖检测</a></li><li class="sidebar-sub-header"><a href="/pages/ca56db/#_9-3-用户代理检测" class="sidebar-link">9.3 用户代理检测</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/ca56db/#_9-3-1-用户代理字符串的历史" class="sidebar-link">9.3.1 用户代理字符串的历史</a></li><li class="sidebar-sub-header"><a href="/pages/ca56db/#_9-3-2-用户代理字符串检测技术" class="sidebar-link">9.3.2 用户代理字符串检测技术</a></li><li class="sidebar-sub-header"><a href="/pages/ca56db/#_9-3-3-完整的代码" class="sidebar-link">9.3.3 完整的代码</a></li><li class="sidebar-sub-header"><a href="/pages/ca56db/#_9-3-4-使用方法" class="sidebar-link">9.3.4 使用方法</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/ca56db/#_9-4-小结" class="sidebar-link">9.4 小结</a></li></ul></li><li><a href="/pages/db0f5b/" class="sidebar-link">第10章 DOM</a></li><li><a href="/pages/8c8da2/" class="sidebar-link">第11章 DOM扩展</a></li><li><a href="/pages/54f651/" class="sidebar-link">第12章 DOM2和DOM3</a></li><li><a href="/pages/cecea8/" class="sidebar-link">第13章 事件</a></li><li><a href="/pages/a963d6/" class="sidebar-link">第14章 表单脚本</a></li><li><a href="/pages/a18149/" class="sidebar-link">第15章 使用Canvas绘图</a></li><li><a href="/pages/97ea51/" class="sidebar-link">第16章 HTML5脚本编程</a></li><li><a href="/pages/9f231d/" class="sidebar-link">第17章 错误处理与调试</a></li><li><a href="/pages/afa7f3/" class="sidebar-link">第18章 JavaScript与XML</a></li><li><a href="/pages/aeeb57/" class="sidebar-link">第19章 E4X</a></li><li><a href="/pages/5a1ef0/" class="sidebar-link">第20章 JSON</a></li><li><a href="/pages/731b29/" class="sidebar-link">第21章 Ajax与Comet</a></li><li><a href="/pages/1e17b2/" class="sidebar-link">第22章 高级技巧</a></li><li><a href="/pages/f25c7c/" class="sidebar-link">第23章 离线应用与客户端存储</a></li><li><a href="/pages/fc4c20/" class="sidebar-link">第24章 最佳实践</a></li><li><a href="/pages/16e70e/" class="sidebar-link">第25章 新兴的API</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/books/professionalJs" title="《JavaScript高级程序设计》-目录页" data-v-1cd794fe>《JavaScript高级程序设计》</a></li> <!----> <!----></ul> <div class="info" data-v-1cd794fe><div title="作者" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/fineliving" target="_blank" title="作者" class="beLink" data-v-1cd794fe>Li Yang</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2020-11-20</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">
          第9章 客户端检测
        </h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="第9章-客户端检测"><a href="#第9章-客户端检测" class="header-anchor">#</a> 第9章 客户端检测</h1> <p><em><strong>1. 本章内容</strong></em></p> <p>本章内容</p> <ul><li>使用能力检测</li> <li>用户代理检测的历史</li> <li>选择检测方式</li></ul> <p><em><strong>2. 客户端检测仍然是Web 开发领域中一个饱受争议的话题</strong></em></p> <p>浏览器提供商虽然在实现公共接口方面投入了很多精力，但结果仍然是每一种浏览器都有各自的长处，也都有各自的缺点。</p> <ul><li>即使是那些跨平台的浏览器，虽然从技术上看版本相同，也照样存在不一致性问题。</li> <li>面对普遍存在的不一致性问题，开发人员要么采取迁就各方的“最小公分母”策略，要么（也是更常见的）就得<strong>利用各种客户端检测方法，来突破或者规避种种局限性</strong>。</li></ul> <p>迄今为止，客户端检测仍然是Web 开发领域中一个饱受争议的话题。</p> <ul><li>一谈到这个话题，人们总会不约而同地提到浏览器应该支持一组最常用的公共功能。在理想状态下，确实应该如此。</li> <li>但是，在现实当中，浏览器之间的差异以及不同浏览器的**“怪癖”（quirk）**，多得简直不胜枚举。</li> <li>因此，<strong>客户端检测除了是一种补救措施之外，更是一种行之有效的开发策略</strong>。</li></ul> <p>检测Web 客户端的手段很多，而且各有利弊。</p> <ul><li>但最重要的还是要知道，不到万不得已，就不要使用客户端检测。</li> <li>只要能找到更通用的方法，就应该优先采用更通用的方法。</li> <li>一言以蔽之，<strong>先设计最通用的方案，然后再使用特定于浏览器的技术增强该方案</strong>。</li></ul> <h2 id="_9-1-能力检测"><a href="#_9-1-能力检测" class="header-anchor">#</a> 9.1 能力检测</h2> <p><em><strong>1. 什么是能力检测</strong></em></p> <p>最常用也最为人们广泛接受的客户端检测形式是能力检测（又称特性检测）。</p> <ul><li><p>能力检测的目标不是识别特定的浏览器，而是<strong>识别浏览器的能力</strong>。</p></li> <li><p>采用这种方式不必顾及特定的浏览器如何如何，只要确定浏览器支持特定的能力，就可以给出解决方案。</p></li> <li><p>能力检测的基本模式如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>object<span class="token punctuation">.</span>propertyInQuestion<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//使用object.propertyInQuestion</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>举例来说，IE5.0 之前的版本不支持document.getElementById()这个DOM 方法。尽管可以使用非标准的document.all 属性实现相同的目的，但IE 的早期版本中确实不存在document.getElementById()。于是，也就有了类似下面的能力检测代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getElement</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>getElementById<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>all<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> document<span class="token punctuation">.</span>all<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;No way to retrieve element!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>这里的getElement()函数的用途是返回具有给定ID 的元素。</p></li> <li><p>因为document.getElementById()是实现这一目的的标准方式，所以一开始就测试了这个方法。如果该函数存在（不是未定义），则使用该函数。</p></li> <li><p>否则，就要继续检测document.all 是否存在，如果是，则使用它。</p></li> <li><p>如果上述两个特性都不存在（很有可能），则创建并抛出错误，表示这个函数无法使用。</p></li></ul></li></ul> <p><em><strong>2. 理解两个重要的概念</strong></em></p> <p>要理解能力检测，首先必须理解两个重要的概念。</p> <ul><li><p>如前所述，第一个概念就是<strong>先检测达成目的的最常用的特性</strong>。对前面的例子来说，就是要先检测document.getElementById()，后检测document.all。先检测最常用的特性可以保证代码最优化，因为在多数情况下都可以避免测试多个条件。</p></li> <li><p>第二个重要的概念就是<strong>必须测试实际要用到的特性。一个特性存在，不一定意味着另一个特性也存在</strong>。来看一个例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getWindowWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>all<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//假设是IE</span>
		<span class="token keyword">return</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span> <span class="token comment">//错误的用法！！！</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>这是一个错误使用能力检测的例子。</li> <li>getWindowWidth()函数首先检查document.all 是否存在，如果是则返回document.documentElement.clientWidth。第8 章曾经讨论过，IE8 及之前版本确实不支持window.innerWidth 属性。</li> <li>但问题是document.all 存在也不一定表示浏览器就是IE。实际上，也可能是Opera；Opera 支持document.all，也支持window.innerWidth。</li></ul></li></ul> <h3 id="_9-1-1-更可靠的能力检测"><a href="#_9-1-1-更可靠的能力检测" class="header-anchor">#</a> 9.1.1 更可靠的能力检测</h3> <p><em><strong>1. 更可靠的能力检测</strong></em></p> <p>能力检测对于想知道某个特性是否**会按照适当方式行事（而不仅仅是某个特性存在）**非常有用。</p> <ul><li><p>上一节中的例子利用类型转换来确定某个对象成员是否存在，但这样你还是不知道该成员是不是你想要的。</p></li> <li><p>来看下面的函数，它用来确定一个对象是否支持排序。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//不要这样做！这不是能力检测——只检测了是否存在相应的方法</span>
<span class="token keyword">function</span> <span class="token function">isSortable</span><span class="token punctuation">(</span><span class="token parameter">object</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span>object<span class="token punctuation">.</span>sort<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>这个函数通过检测对象是否存在sort()方法，来确定对象是否支持排序。</p></li> <li><p>问题是，任何包含sort属性的对象也会返回true。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">isSortable</span><span class="token punctuation">(</span><span class="token punctuation">{</span> sort<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>检测某个属性是否存在并不能确定对象是否支持排序。更好的方式是检测sort 是不是一个函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//这样更好：检查sort 是不是函数</span>
<span class="token keyword">function</span> <span class="token function">isSortable</span><span class="token punctuation">(</span><span class="token parameter">object</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">typeof</span> object<span class="token punctuation">.</span>sort <span class="token operator">==</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>这里的typeof 操作符用于确定sort 的确是一个函数，因此可以调用它对数据进行排序。</li></ul></li></ul></li></ul> <p><em><strong>2. 尽量使用typeof 进行能力检测</strong></em></p> <p>在可能的情况下，要尽量使用typeof 进行能力检测。</p> <ul><li><p><strong>特别是，宿主对象没有义务让typeof 返回合理的值</strong>。最令人发指的事儿就发生在IE 中。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//在IE8 及之前版本中不行</span>
<span class="token keyword">function</span> <span class="token function">hasCreateElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">typeof</span> document<span class="token punctuation">.</span>createElement <span class="token operator">==</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>大多数浏览器在检测到document.createElement()存在时，都会返回true。</li> <li>在IE8 及之前版本中，这个函数返回false，因为typeof document.createElement     返回的是&quot;object&quot;，而不是&quot;function&quot;。</li> <li>如前所述，DOM对象是宿主对象，<strong>IE 及更早版本中的宿主对象是通过COM 而非JScript 实现的</strong>。因此，document.createElement()函数确实是一个COM 对象，所以typeof 才会返回&quot;object&quot;。</li> <li>IE9 纠正了这个问题，对所有DOM 方法都返回&quot;function&quot;。</li></ul></li> <li><p>关于typeof 的行为不标准，IE 中还可以举出例子来。ActiveX 对象（只有IE 支持）与其他对象的行为差异很大。例如，<strong>不使用typeof 测试某个属性会导致错误</strong>，如下所示。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//在IE 中会导致错误</span>
<span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActiveXObject</span><span class="token punctuation">(</span><span class="token string">&quot;Microsoft.XMLHttp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>open<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//这里会发生错误</span>
	<span class="token comment">//执行操作</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>像这样直接把函数作为属性访问会导致JavaScript 错误。</p></li> <li><p>使用typeof 操作符会更靠谱一点，但IE对typeof xhr.open 会返回&quot;unknown&quot;。</p></li> <li><ul><li><p>这就意味着，在浏览器环境下测试任何对象的某个特性是否存在，要使用下面这个函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//作者：Peter Michaux</span>
<span class="token keyword">function</span> <span class="token function">isHostMethod</span><span class="token punctuation">(</span><span class="token parameter">object<span class="token punctuation">,</span> property</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token keyword">typeof</span> object<span class="token punctuation">[</span>property<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> t<span class="token operator">==</span><span class="token string">'function'</span> <span class="token operator">||</span>
		<span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span>t<span class="token operator">==</span><span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> object<span class="token punctuation">[</span>property<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
		t<span class="token operator">==</span><span class="token string">'unknown'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>可以像下面这样使用这个函数：</p> <div class="language-js extra-class"><pre class="language-js"><code>result <span class="token operator">=</span> <span class="token function">isHostMethod</span><span class="token punctuation">(</span>xhr<span class="token punctuation">,</span> <span class="token string">&quot;open&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span>
result <span class="token operator">=</span> <span class="token function">isHostMethod</span><span class="token punctuation">(</span>xhr<span class="token punctuation">,</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//false</span>
</code></pre></div></li></ul></li> <li><p>目前使用isHostMethod()方法还是比较可靠的，因为它考虑到了浏览器的怪异行为。</p> <ul><li><p>不过也要注意，宿主对象没有义务保持目前的实现方式不变，也不一定会模仿已有宿主对象的行为。</p></li> <li><p>所以，这个函数——以及其他类似函数，都不能百分之百地保证永远可靠。作为开发人员，必须对自己要使用某个功能的风险作出理性的估计。</p></li></ul></li></ul></li></ul> <p><em><strong>3. 网站</strong></em></p> <p>要想深入了解围绕JavaScript 中能力检测的一些观点，请参考Peter Michaux 的文章“Feature Detection: State of the Art Browser Scripting”，网址为http://peter.michaux.ca/articles/feature-detection-state-of-the-art-browser-scripting。</p> <h3 id="_9-1-2-能力检测-不是浏览器检测"><a href="#_9-1-2-能力检测-不是浏览器检测" class="header-anchor">#</a> 9.1.2 能力检测，不是浏览器检测</h3> <p><em><strong>1. 能力检测，不是浏览器检测</strong></em></p> <p>检测某个或某几个特性并不能够确定浏览器。</p> <ul><li><p>下面给出的这段代码（或与之差不多的代码）可以在许多网站中看到，这种“浏览器检测”代码就是错误地依赖能力检测的典型示例。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//错误！还不够具体</span>
<span class="token keyword">var</span> isFirefox <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>vendor <span class="token operator">&amp;&amp;</span> navigator<span class="token punctuation">.</span>vendorSub<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//错误！假设过头了</span>
<span class="token keyword">var</span> isIE <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>all <span class="token operator">&amp;&amp;</span> document<span class="token punctuation">.</span>uniqueID<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>这两行代码代表了对能力检测的典型误用。</li> <li>以前，确实可以通过检测navigator.vendor 和navigator.vendorSub 来确定Firefox 浏览器。但是，Safari 也依葫芦画瓢地实现了相同的属性。于是，这段代码就会导致人们作出错误的判断。</li> <li>为检测IE，代码测试了document.all 和document.uniqueID。这就相当于假设IE 将来的版本中仍然会继续存在这两个属性，同时还假设其他浏览器都不会实现这两个属性。最后，这两个检测都使用了双逻辑非操作符来得到布尔值（比先存储后访问的效果更好）。</li></ul></li></ul> <p><em><strong>2. 更可取的能力检测</strong></em></p> <p>实际上，<strong>根据浏览器不同将能力组合起来是更可取的方式</strong>。</p> <ul><li><p>如果你知道自己的应用程序需要使用某些特定的浏览器特性，那么最好是一次性检测所有相关特性，而不要分别检测。看下面的例子。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//确定浏览器是否支持Netscape 风格的插件</span>
<span class="token keyword">var</span> hasNSPlugins <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>plugins <span class="token operator">&amp;&amp;</span> navigator<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//确定浏览器是否具有DOM1 级规定的能力</span>
<span class="token keyword">var</span> hasDOM1 <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>getElementById <span class="token operator">&amp;&amp;</span> document<span class="token punctuation">.</span>createElement <span class="token operator">&amp;&amp;</span> document<span class="token punctuation">.</span>getElementsByTagName<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p>以上例子展示了两个检测：</p></li> <li><ul><li>一个检测浏览器是否支持Netscapte 风格的插件；</li> <li>另一个检测浏览器是否具备DOM1 级所规定的能力。</li></ul></li> <li><p>得到的布尔值可以在以后继续使用，从而节省重新检测能力的时间。</p></li></ul></li></ul> <p>在实际开发中，应该<strong>将能力检测作为确定下一步解决方案的依据</strong>，而不是用它来判断用户使用的是什么浏览器。</p> <h2 id="_9-2-怪癖检测"><a href="#_9-2-怪癖检测" class="header-anchor">#</a> 9.2 怪癖检测</h2> <p><em><strong>1. 怪癖检测</strong></em></p> <p>与能力检测类似，怪癖检测（quirks detection）的目标是识别浏览器的特殊行为。</p> <ul><li>但与能力检测确认浏览器支持什么能力不同，怪癖检测是想要知道浏览器存在什么缺陷（“怪癖”也就是bug）。</li> <li>这通常需要运行一小段代码，以确定某一特性不能正常工作。</li></ul> <p>一般来说，“怪癖”都是个别浏览器所独有的，而且通常<strong>被归为bug</strong>。在相关浏览器的新版本中，这些问题可能会也可能不会被修复。</p> <ul><li>由于检测“怪癖”涉及运行代码，因此我们建议<strong>仅检测那些对你有直接影响的“怪癖”，而且最好在脚本一开始就执行此类检测</strong>，以便尽早解决问题。</li></ul> <p><em><strong>2. IE8 怪癖</strong></em></p> <p>例如，IE8 及更早版本中存在一个bug，<strong>即如果某个实例属性与[[Enumerable]]标记为false 的某个原型属性同名，那么该实例属性将不会出现在fon-in 循环当中</strong>。</p> <ul><li><p>可以使用如下代码来检测这种“怪癖”。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">hasDontEnumQuirk</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

	<span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function-variable function">toString</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> prop <span class="token keyword">in</span> o<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>prop <span class="token operator">==</span> <span class="token string">&quot;toString&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>以上代码通过一个匿名函数来测试该“怪癖”，函数中创建了一个带有toString()方法的对象。</li> <li>在正确的ECMAScript 实现中，toString 应该在for-in 循环中作为属性返回。</li></ul></li></ul> <p><em><strong>3. Safari 3怪癖</strong></em></p> <p>另一个经常需要检测的“怪癖”是Safari 3 以前版本会<strong>枚举被隐藏的属性</strong>。</p> <ul><li><p>可以用下面的函数来检测该“怪癖”。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">hasEnumShadowsQuirk</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

	<span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function-variable function">toString</span> <span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> prop <span class="token keyword">in</span> o<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>prop <span class="token operator">==</span> <span class="token string">&quot;toString&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			count<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">return</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>如果浏览器存在这个bug，那么使用for-in 循环枚举带有自定义的toString()方法的对象，就会返回两个toString 的实例。</li></ul></li></ul> <h2 id="_9-3-用户代理检测"><a href="#_9-3-用户代理检测" class="header-anchor">#</a> 9.3 用户代理检测</h2> <p><em><strong>1. 用户代理检测</strong></em></p> <p>第三种，也是争议最大的一种客户端检测技术叫做用户代理检测。</p> <ul><li>用户代理检测<strong>通过检测用户代理字符串来确定实际使用的浏览器</strong>。</li> <li>在每一次HTTP 请求过程中，用户代理字符串是作为响应首部发送的，而且该字符串可以通过JavaScript 的navigator.userAgent 属性访问。</li> <li>在服务器端，通过检测用户代理字符串来确定用户使用的浏览器是一种常用而且广为接受的做法。</li> <li>而在客户端，用户代理检测一般被当作一种万不得已才用的做法，其优先级排在能力检测和（或）怪癖检测之后。</li></ul> <p><em><strong>2. 电子欺骗</strong></em></p> <p>提到与用户代理字符串有关的争议，就不得不提到电子欺骗（spoofing）。</p> <ul><li>所谓电子欺骗，就是指浏览器通过在自己的用户代理字符串加入一些错误或误导性信息，来达到欺骗服务器的目的。</li> <li>要弄清楚这个问题的来龙去脉，必须从Web 问世初期<strong>用户代理字符串的发展讲起</strong>。</li></ul> <h3 id="_9-3-1-用户代理字符串的历史"><a href="#_9-3-1-用户代理字符串的历史" class="header-anchor">#</a> 9.3.1 用户代理字符串的历史</h3> <p><em><strong>1. HTTP 规范浏览器名称和版本号</strong></em></p> <p>HTTP 规范（包括1.0 和1.1 版）明确规定，<strong>浏览器应该发送简短的用户代理字符串，指明浏览器的名称和版本号</strong>。</p> <ul><li><p>RFC 2616（即HTTP 1.1 协议规范）是这样描述用户代理字符串的：</p> <p><em>“产品标识符常用于通信应用程序标识自身，由软件名和版本组成。使用产品标识符的大多数领域也允许列出作为应用程序主要部分的子产品，由空格分隔。按照惯例，产品要按照相应的重要程度依次列出，以便标识应用程序。”</em></p></li> <li><p>上述规范进一步规定，用户代理字符串应该以一组产品的形式给出，<strong>字符串格式为：标识符/产品版本号</strong>。但是，现实中的用户代理字符串则绝没有如此简单。</p></li></ul> <p><em><strong>2. 早期的浏览器</strong></em></p> <ul><li><p>1993 年，美国NCSA（National Center for     Supercomputing Applications，国家超级计算机中心）发布了世界上第一款Web 浏览器Mosaic。这款浏览器的用户代理字符串非常简单，类似如下所示。</p> <div class="language- extra-class"><pre class="language-text"><code>Mosaic/0.9
</code></pre></div><ul><li>尽管这个字符串在不同操作系统和不同平台下会有所变化，但其基本格式还是简单明了的。正斜杠前面的文本表示产品名称（有时候会出现NCSA Mosaic 或其他类似字样），而斜杠后面的文本是产品的版本号。</li></ul></li> <li><p>Netscape Communications 公司介入浏览器开发领域后，遂将自己产品的代号定名为Mozilla（MosaicKiller 的简写，意即Mosaic 杀手）。该公司第一个公开发行版，Netscape Navigator 2 的用户代理字符串具有如下格式。</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/版本号 [语言] (平台; 加密类型)  
</code></pre></div><ul><li><p>Netscape 在坚持将产品名和版本号作为用户代理字符串开头的基础上，又在后面依次添加了下列信息。</p> <ul><li>语言：即语言代码，表示应用程序针对哪种语言设计。</li> <li>平台：即操作系统和（或）平台，表示应用程序的运行环境。</li> <li>加密类型：即安全加密的类型。可能的值有U（128 位加密）、I（40 位加密）和N（未加密）。</li></ul></li> <li><p>典型的Netscape Navigator 2 的用户代理字符串如下所示。</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/2.02 [fr] (WinNT; I)
</code></pre></div><ul><li>这个字符串表示浏览器是Netscape Navigator 2.02，为法语国家编译，运行在Windows NT 平台下，加密类型为40 位。那个时候，通过用户代理字符串中的产品名称，至少还能够轻易地确定用户使用的是什么浏览器。</li></ul></li></ul></li></ul> <p><em><strong>3. Netscape Navigator 3 和Internet Explorer 3</strong></em></p> <ul><li><p>1996 年，Netscape Navigator 3 发布，随即超越Mosaic 成为当时最流行的Web 浏览器。而用户代理字符串只作了一些小的改变，删除了语言标记，同时允许添加操作系统或系统使用的CPU 等可选信息。于是，格式变成如下所示。</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/版本号 (平台; 加密类型 [; 操作系统或CPU 说明])  
</code></pre></div><ul><li><p>运行在Windows 系统下的Netscape Navigator 3 的用户代理字符串大致如下。</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/3.0 (Win95; U)
</code></pre></div><ul><li>这个字符串表示Netscape Navigator 3 运行在Windows 95 中，采用了128 位加密技术。可见，在Windows 系统中，字符串中的操作系统或CPU 说明被省略了。</li></ul></li></ul></li> <li><p>Netscape Navigator 3 发布后不久，微软也发布了其第一款赢得用户广泛认可的Web 浏览器，即Internet Explorer 3。由于Netscape 浏览器在当时占绝对市场份额，许多服务器在提供网页之前都要专门检测该浏览器。如果用户通过IE 打不开相关网页，那么这个新生的浏览器很可能就会夭折。于是，微软决定将IE 的用户代理字符串修改成兼容Netscape 的形式，结果如下：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/2.0  (compatible; MSIE 版本号; 操作系统)  
</code></pre></div><ul><li><p>例如，Windows 95 平台下的Internet Explorer 3.02 带有如下用户代理字符串：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/2.0 (compatible; MSIE 3.02; Windows 95)
</code></pre></div><ul><li>由于当时的大多数浏览器嗅探程序只检测用户代理字符串中的产品名称部分，结果IE 就成功地将自己标识为Mozilla，从而伪装成Netscape Navigator。微软的这一做法招致了很多批评，因为它违反了浏览器标识的惯例。</li> <li>更不规范的是，IE 将真正的浏览器版本号插入到了字符串的中间。</li> <li>字符串中另外一个有趣的地方是标识符Mozilla 2.0（而不是3.0）。毕竟，当时的主流版本是3.0，改成3.0 应该对微软更有利才对。但真正的谜底到现在还没有揭开——但很可能只是人为疏忽所致。</li></ul></li></ul></li></ul> <p><em><strong>4. Netscape Communicator 4 和IE4～IE8</strong></em></p> <ul><li><p>1997 年8 月，Netscapte Communicator 4 发布（这一版将浏览器名字中的Navigator 换成了Communicator）。Netscape 继续遵循了第3 版时的用户代理字符串格式：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/版本号 (平台; 加密类型 [; 操作系统或CPU 说明])
</code></pre></div><ul><li><p>因此，Windows 98 平台中第4 版的用户代理字符串如下所示：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/4.0 (Win98; I)
</code></pre></div></li> <li><p>Netscape 在发布补丁时，子版本号也会相应提高，用户代理字符串如下面的4.79 版所示：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/4.79 (Win98; I)
</code></pre></div></li></ul></li> <li><p>但是，微软在发布Internet Explorer 4 时，顺便将用户代理字符串修改成了如下格式：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/4.0  (compatible; MSIE 版本号; 操作系统)
</code></pre></div><ul><li><p>换句话说，对于Windows 98 中运行的IE4 而言，其用户代理字符串为：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/4.0 (compatible; MSIE 4.0; Windows 98)
</code></pre></div><ul><li><p>经过此番修改，Mozilla 版本号就与实际的IE 版本号一致了，为识别它们的第四代浏览器提供了方便。</p></li> <li><p>但令人遗憾的是，两者的一致性仅限于这一个版本。在Internet Explorer 4.5 发布时（只针对Macs），虽然Mozilla 版本号还是4，但IE 版本号则改成了如下所示：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/4.0 (compatible; MSIE 4.5; Mac_PowerPC)
</code></pre></div></li> <li><p>此后，IE 的版本一直到7 都沿袭了这个模式：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)
</code></pre></div></li> <li><p>而IE8 的用户代理字符串中添加了呈现引擎（Trident）的版本号：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/4.0 (compatible; MSIE 版本号; 操作系统; Trident/Trident 版本号)
</code></pre></div><ul><li><p>例如：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)
</code></pre></div></li></ul></li> <li><p>这个新增的Trident 记号是为了让开发人员知道IE8 是不是在兼容模式下运行。如果是，则MSIE 的版本号会变成7，但Trident 及版本号还会留在用户代码字符串中：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0)
</code></pre></div><ul><li>增加这个记号有助于分辨浏览器到底是IE7（没有Trident 记号），还是运行在兼容模式下的IE8。</li></ul></li></ul></li></ul></li> <li><p>IE9 对字符串格式做了一点调整。Mozilla 版本号增加到了5.0，而Trident 的版本号也升到了5.0。IE9默认的用户代理字符串如下：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/5.0  (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)  
</code></pre></div><ul><li><p>如果IE9 运行在兼容模式下，字符串中的Mozilla 版本号和MSIE 版本号会恢复旧的值，但Trident的版本号仍然是5.0。例如，下面就是IE9 运行在IE7 兼容模式下的用户代理字符串：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/4.0  (compatible; MSIE 7.0; Windows NT 6.1; Trident/5.0)
</code></pre></div><ul><li>所有这些变化都是为了确保过去的用户代理检测脚本能够继续发挥作用，同时还能给新脚本提供更丰富的信息。</li></ul></li></ul></li></ul> <p><em><strong>5. Gecko</strong></em></p> <p>Gecko 是Firefox 的呈现引擎。当初的Gecko 是作为通用Mozilla 浏览器的一部分开发的，而第一个采用Gecko 引擎的浏览器是Netscape 6。</p> <ul><li><p>为Netscape 6 编写的一份规范中规定了未来版本中用户代理字符串的构成。这个新格式与4.x 版本中相对简单的字符串相比，有着非常大的区别，如下所示：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/Mozilla 版本号 (平台; 加密类型; 操作系统或CPU; 语言; 预先发行版本)
</code></pre></div><ul><li><p>Gecko/Gecko 版本号 应用程序或产品/应用程序或产品版本号</p></li> <li><p>这个明显复杂了很多的用户代理字符串中蕴含很多新想法。下表列出了字符串中各项的用意。</p> <table><thead><tr><th>字符串项</th> <th>必需吗</th> <th>说 明</th></tr></thead> <tbody><tr><td>Mozilla版本号</td> <td>是</td> <td>Mozilla的版本号</td></tr> <tr><td>平台</td> <td>是</td> <td>浏览器运行的平台。可能的值包括Windows、Mac和X11（指Unix的X窗口系统）</td></tr> <tr><td>加密类型</td> <td>是</td> <td>加密技术的类型：U表示128位、I表示40位、N表示未加密</td></tr> <tr><td>操作系统或CPU</td> <td>是</td> <td>浏览器运行的操作系统或计算机系统使用的CPU。在Windows平台中，这一项指Windows的版本（如WinNT、Win95，等等）。如果平台是Macintosh，这一项指CPU（针对PowerPC的68K、PPC，或MacIntel）。如果平台是X11，这一项是Unix操作系统的名称，与使用Unix命令uname–sm得到的名称相同</td></tr> <tr><td>语言</td> <td>是</td> <td>浏览器设计时所针对的目标用户语言</td></tr> <tr><td>预先发行版本</td> <td>否</td> <td>最初用于表示Mozilla的预先发行版本，现在则用来表示Gecko呈现引擎的版本号</td></tr> <tr><td>Gecko版本号</td> <td>是</td> <td>Gecko呈现引擎的版本号，但由yyyymmdd格式的日期表示</td></tr> <tr><td>应用程序或产品</td> <td>否</td> <td>使用Gecko的产品名。可能是Netscape、Firefox等</td></tr> <tr><td>应用程序或产品版本号</td> <td>否</td> <td>应用程序或产品的版本号；用于区分Mozilla版本号和Gecko版本号</td></tr></tbody></table></li> <li><p>为了帮助读者更好地理解Gecko 的用户代理字符串，下面我们来看几个从基于Gecko 的浏览器中取得的字符串。</p> <div class="language- extra-class"><pre class="language-text"><code>Windows XP 下的Netscape 6.21：
	Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:0.9.4) Gecko/20011128 Netscape6/6.2.1
Linux 下的SeaMonkey 1.1a：
	Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.8.1b2) Gecko/20060823 SeaMonkey/1.1a
Windows XP 下的Firefox 2.0.0.11：
	Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.11) Gecko/20071127 		Firefox/2.0.0.11
Mac OS X 下的Camino 1.5.1：
	Mozilla/5.0 (Macintosh; U; Intel Mac OS X; en; rv:1.8.1.6) Gecko/20070809 Camino/1.5.1
</code></pre></div><ul><li>以上这些用户代理字符串都取自基于Gecko 的浏览器（只是版本有所不同）。很多时候，<strong>检测特定的浏览器还不如搞清楚它是否基于Gecko更重要</strong>。</li> <li>每个字符串中的Mozilla 版本都是5.0，自从第一个基于Gecko 的浏览器发布时修改成这个样子，至今就没有改变过；而且，看起来以后似乎也不会有什么变化。</li></ul></li> <li><p>随着Firefox 4 发布，Mozilla 简化了这个用户代理字符串。主要改变包括以下几方面。</p></li> <li><ul><li>删除了“语言”记号（例如，前面例子中的“en-US”）。</li></ul></li> <li><ul><li>在浏览器使用强加密（默认设置）时，不显示“加密类型”。也就是说，Mozilla 用户代理字符串中不会再出现“U”，而“I”和“N”还会照常出现。</li> <li>“平台”记号从Windows 用户代理字符串中删除了，“操作系统或CPU”中始终都包含“Windows”字符串。</li> <li>“Gecko 版本号”固定为“Gecko/20100101”。</li></ul></li> <li><p>最后，Firefox 4 用户代理字符串变成了下面这个样子：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/5.0 (Windows NT 6.1; rv:2.0.1) Gecko/20100101 Firefox 4.0.1
</code></pre></div></li></ul></li></ul> <p><em><strong>6. WebKit</strong></em></p> <p>2003 年，Apple 公司宣布要发布自己的Web 浏览器，名字定为Safari。Safari 的呈现引擎叫WebKit，是Linux 平台中Konqueror 浏览器的呈现引擎KHTML 的一个分支。几年后，WebKit 独立出来成为了一个开源项目，专注于呈现引擎的开发。</p> <ul><li><p>这款新浏览器和呈现引擎的开发人员也遇到了与Internet Explorer 3.0 类似的问题：如何确保这款浏览器不被流行的站点拒之门外？答案就是向用户代理字符串中放入足够多的信息，以便站点能够信任它与其他流行的浏览器是兼容的。于是，WebKit 的用户代理字符串就具备了如下格式：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/5.0 (平台; 加密类型; 操作系统或CPU; 语言) AppleWebKit/AppleWebKit 版本号  (KHTML, like Gecko) Safari/Safari 版本号
</code></pre></div><ul><li><p>以下就是一个示例：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/5.0 (Macintosh; U; PPC Mac OS X; en) AppleWebKit/124 (KHTML, like Gecko) Safari/125.1
</code></pre></div><ul><li>显然，这又是一个很长的用户代理字符串。其中不仅包含了Apple WebKit 的版本号，也包含了Safari的版本号。</li> <li>出于兼容性的考虑，有关人员很快就决定了将Safari 标识为Mozilla。至今，基于WebKit 的所有浏览器都将自己标识为Mozilla 5.0，与基于Gecko 的浏览器完全一样。</li> <li>但Safari 的版本号则通常是浏览器的编译版本号，不一定与发布时的版本号对应。换句话说，虽然Safari 1.25 的用户代理字符串中包含数字125.1，但两者却不一一对应。</li></ul></li> <li><p>Safari 预发行1.0 版用户代理字符串中最耐人寻味，也是最饱受诟病的部分就是字符串&quot;(KHTML,like     Gecko)&quot;。</p></li> <li><ul><li>Apple 因此收到许多开发人员的反馈，他们认为这个字符串明显是在欺骗客户端和服务器，实际上是想让它们把Safari 当成Gecko（好像光添加Mozilla/5.0 还嫌不够）。</li> <li>Apple 的回应与微软在IE 的用户代理字符串遭到责难时如出一辙：Safari 与Mozilla 兼容，因此网站不应该将Safari 用户拒之门外，否则用户就会认为自己的浏览器不受支持。</li></ul></li> <li><p>到了Safari 3.0 发布时，其用户代理字符串又稍微变长了一点。下面这个新增的Version 记号一直到现在都被用来标识Safari 实际的版本号：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/5.0 (Macintosh; U; PPC Mac OS X; en) AppleWebKit/522.15.5 (KHTML, like Gecko) Version/3.0.3 Safari/522.15.5
</code></pre></div><ul><li>需要注意的是，这个变化只在Safari 中有，在WebKit 中没有。换句话说，其他基于WebKit 的浏览器可能没有这个变化。</li></ul></li> <li><p>一般来说，<strong>确定浏览器是否基于WebKit要比确定它是不是Safari 更有价值，就像针对Gecko 一样</strong>。</p></li></ul></li></ul> <p><em><strong>7. Konqueror</strong></em></p> <p>与KDE Linux 集成的Konqueror，<strong>是一款基于KHTML开源呈现引擎的浏览器</strong>。尽管Konqueror 只能在Linux 中使用，但它也有数量可观的用户。</p> <ul><li><p>为确保最大限度的兼容性，Konqueror 效仿IE 选择了如下用户代理字符串格式：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/5.0 (compatible; Konqueror/ 版本号; 操作系统或CPU)
</code></pre></div></li> <li><p>不过，为了与WebKit 的用户代理字符串的变化保持一致，Konqueror 3.2 又有了变化，以如下格式将自己标识为KHTML：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/5.0 (compatible; Konqueror/ 版本号; 操作系统或CPU) KHTML/ KHTML 版本号 (like Gecko)
</code></pre></div><ul><li><p>下面是一个例子：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/5.0 (compatible; Konqueror/3.5; SunOS) KHTML/3.5.0 (like Gecko)
</code></pre></div></li> <li><p>其中，Konqueror 与KHTML 的版本号比较一致，即使有差别也很小，例如Konqueror 3.5 使用KHTML3.5.1。</p></li></ul></li></ul> <p><em><strong>8. Chrome</strong></em></p> <p>谷歌公司的Chrome 浏览器<strong>以WebKit 作为呈现引擎，但使用了不同的JavaScript引擎</strong>。</p> <ul><li><p>在Chrome 0.2这个最初的 beta 版中，<strong>用户代理字符串完全取自WebKit，只添加了一段表示Chrome 版本号的信息</strong>，格式如下：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/5.0 ( 平台; 加密类型; 操作系统或CPU; 语言) AppleWebKit/AppleWebKit 版本号 (KHTML,like Gecko) Chrome/ Chrome 版本号 Safari/ Safari 版本
</code></pre></div><ul><li><p>Chrome 7 的完整的用户代理字符串如下：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/534.7 (KHTML,like Gecko) Chrome/7.0.517.44 Safari/534.7
</code></pre></div></li> <li><p>其中，WebKit 版本与Safari 版本看起来似乎始终会保持一致，尽管没有十分的把握。</p></li></ul></li></ul> <p><em><strong>9. Opera</strong></em></p> <p>仅就用户代理字符串而言，Opera 应该是最有争议的一款浏览器了。Opera 默认的用户代理字符串是所有现代浏览器中最合理的——正确地标识了自身及其版本号。</p> <ul><li><p>在Opera 8.0 之前，其用户代理字符串采用如下格式：</p> <div class="language- extra-class"><pre class="language-text"><code>Opera/ 版本号 (操作系统或CPU; 加密类型) [语言]
</code></pre></div><ul><li><p>Windows XP 中的Opera 7.54 会显示下面的用户代理字符串：</p> <div class="language- extra-class"><pre class="language-text"><code>Opera/7.54 (Windows NT 5.1; U) [en]
</code></pre></div></li></ul></li> <li><p>Opera 8 发布后，用户代理字符串的“语言”部分被移到圆括号内，以便更好地与其他浏览器匹配，如下所示：</p> <div class="language- extra-class"><pre class="language-text"><code>Opera/ 版本号 (操作系统或CPU; 加密类型; 语言)
</code></pre></div><ul><li><p>Windows XP 中的Opera 8 会显示下面的用户代理字符串：</p> <div class="language- extra-class"><pre class="language-text"><code>Opera/8.0 (Windows NT 5.1; U; en)
</code></pre></div><ul><li>默认情况下，Opera 会以上面这种简单的格式返回一个用户代理字符串。</li> <li>目前来看，Opera 也是主要浏览器中唯一一个使用产品名和版本号来完全彻底地标识自身的浏览器。</li> <li>可是，与其他浏览器一样，Opera 在使用自己的用户代理字符串时也遇到了问题。即使技术上正确，但因特网上仍然有不少浏览器嗅探代码，只钟情于报告Mozilla 产品名的那些用户代理字符串。另外还有相当数量的代码则只对IE 或Gecko 感兴趣。
<ul><li>Opera 没有选择通过修改自身的用户代理字符串来迷惑嗅探代码，而是干脆选择通过修改自身的用户代理字符串将自身标识为一个完全不同的浏览器。</li></ul></li></ul></li></ul></li> <li><p>Opera 9 以后，出现了两种修改用户代理字符串的方式。</p></li> <li><ol><li><p>一种方式是将自身标识为另外一个浏览器，如Firefox 或者IE。</p> <ul><li><p>在这种方式下，用户代理字符串就如同Firefox 或IE 的用户代理字符串一样，只不过末尾追加了字符串Opera 及Opera 的版本号。</p></li> <li><p>下面是一个例子：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/5.0 (Windows NT 5.1; U; en; rv:1.8.1) Gecko/20061208 Firefox/2.0.0 Opera 9.50 Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; en) Opera 9.50
</code></pre></div><ul><li><p>第一个字符串将Opera 9.5 标识为Firefox 2，同时带有Opera 版本信息。</p></li> <li><p>第二个字符串将Opera 9.5标识为IE6，也包含了Opera 版本信息。这两个用户代理字符串可以通过针对Firefox 或IE 的大多数测试，不过还是为识别Opera 留下了余地。</p></li></ul></li></ul></li> <li><p>另一种方式，就是把第一个字符串将Opera 9.5 标识为Firefox 2，同时带有Opera 版本信息。</p> <ul><li><p>第二个字符串将Opera 9.5标识为IE6，也包含了Opera 版本信息。这两个用户代理字符串可以通过针对Firefox 或IE 的大多数测试，不过还是为识别Opera 留下了余地。</p></li> <li><p>自己装扮成Firefox 或IE。</p> <ul><li>在这种隐瞒真实身份的情况下，用户代理字符串实际上与其他浏览器返回的相同——既没有Opera 字样，也不包含Opera 版本信息。</li> <li>换句话说，在启用了身份隐瞒功能的情况下，无法将Opera 和其他浏览器区别开来。另外，由于Opera 喜欢在不告知用户的情况下针对站点来设置用户代理字符串，因此问题就更复杂化了。</li> <li>例如，打开MyYahoo!站点（http://my.yahoo.com）会自动导致Opera 将自己装扮成Firefox。如此一来，要想识别Opera就难上加难了。</li></ul></li></ul></li></ol></li> <li><p>在Opera 7 以前的版本中，Opera 会解析Windows 操作系统字符串的含义。</p></li> <li><ul><li>例如，Windows NT 5.1 实际上就是Windows XP，因此Opera 会在用户代理字符串中包含Windows XP 而非Windows NT 5.1。为了与其他浏览器更兼容，Opera 7 开始包含正式的操作系统版本，而非解析后的版本。</li></ul></li> <li><p>Opera 10 对代理字符串进行了修改。现在的格式是：</p> <div class="language- extra-class"><pre class="language-text"><code>Opera/9.80 (操作系统或CPU; 加密类型; 语言) Presto/Presto 版本号 Version/版本号
</code></pre></div><ul><li><p>注意，初始的版本号Opera/9.80 是固定不变的。实际并没有Opera 9.8，但工程师们担心写得不好的浏览器嗅探脚本会将Opera/10.0 错误的解释为Opera 1，而不是Opera 10。</p></li> <li><p>因此，Opera 10 又增加了Presto记号（Presto 是Opera 的呈现引擎）和Version 记号，后者用以保存实际的版本号。</p></li> <li><ul><li><p>以下是Windows7 中Opera 10.63 的用户代理字符串：</p> <div class="language- extra-class"><pre class="language-text"><code>Opera/9.80 (Windows NT 6.1; U; en) Presto/2.6.30 Version/10.63
</code></pre></div></li></ul></li></ul></li></ul> <p><em><strong>10. iOS 和Android</strong></em></p> <p>移动操作系统iOS 和Android 默认的浏览器都基于WebKit，而且都像它们的桌面版一样，共享相同的基本用户代理字符串格式。</p> <ul><li><p>iOS 设备的基本格式如下：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/5.0 (平台; 加密类型; 操作系统或CPU like Mac OS X; 语言)AppleWebKit/AppleWebKit 版本号 (KHTML, like Gecko) Version/浏览器版本号Mobile/移动版本号 Safari/Safari 版本号
</code></pre></div><ul><li><p>注意用于辅助确定Mac 操作系统的&quot;like Mac OS X&quot;和额外的Mobile 记号。</p></li> <li><p>一般来说，Mobile记号的版本号（移动版本号）没什么用，主要是用来确定WebKit 是移动版，而非桌面版。而平台则可能是&quot;iPhone&quot;、&quot;iPod&quot;或&quot;iPad&quot;。例如：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/5.0 (iPhone; U; CPU iPhone OS 3_0 like Mac OS X; en-us)AppleWebKit/528.18 (KHTML, like Gecko) Version/4.0 Mobile/7A341 Safari/528.16
</code></pre></div></li> <li><p>在iOS 3 之前，用户代理字符串中不会出现操作系统版本号。</p></li></ul></li> <li><p>Android 浏览器中的默认格式与iOS 的格式相似，没有移动版本号（但有Mobile 记号）。</p> <ul><li><p>例如：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/5.0 (Linux; U; Android 2.2; en-us; Nexus One Build/FRF91)
AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1
</code></pre></div></li> <li><p>这是Google Nexus One 手机的用户代理字符串。不过，其他Android 设备的模式也一样。</p></li></ul></li></ul> <h3 id="_9-3-2-用户代理字符串检测技术"><a href="#_9-3-2-用户代理字符串检测技术" class="header-anchor">#</a> 9.3.2 用户代理字符串检测技术</h3> <p>***1. ***</p> <p>考虑到历史原因以及现代浏览器中用户代理字符串的使用方式，通过用户代理字符串来检测特定的浏览器并不是一件轻松的事。因此，首先要确定的往往是你需要多么具体的浏览器信息。</p> <ul><li><p>一般情况下，<strong>知道呈现引擎和最低限度的版本就足以决定正确的操作方法了</strong>。</p></li> <li><p>例如，我们不推荐使用下列代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>isIE6 <span class="token operator">||</span> isIE7<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//不推荐!!!</span>
	<span class="token comment">//代码</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>这个例子是想要在浏览器为IE6 或IE7 时执行相应代码。</p></li> <li><p>这种代码其实是很脆弱的，因为它要依据特定的版本来决定做什么。如果是IE8 怎么办呢？<strong>只要IE有新版本出来，就必须更新这些代码</strong>。</p></li> <li><p>不过，像下面这样使用相对版本号则可以避免此问题：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>ieVer <span class="token operator">&gt;=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//代码</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>这个例子首先检测IE 的版本号是否至少等于6，如果是则执行相应操作。</li> <li>这样就可以确保相应的代码将来照样能够起作用。</li> <li>我们下面的浏览器检测脚本就将本着这种思路来编写。</li></ul></li></ul></li></ul> <p><em><strong>2. 识别呈现引擎</strong></em></p> <ul><li><p>如前所述，确切知道浏览器的名字和版本号不如确切知道它使用的是什么呈现引擎。</p></li> <li><ul><li>如果Firefox、Camino 和Netscape 都使用相同版本的Gecko，那它们一定支持相同的特性。</li> <li>类似地，不管是什么浏览器，只要它跟Safari 3 使用的是同一个版本的WebKit，那么该浏览器也就跟Safari 3 具备同样的功能。</li> <li>因此，我们要编写的脚本将主要检测<strong>五大呈现引擎：IE、Gecko、WebKit、KHTML 和Opera</strong>。</li></ul></li> <li><p>为了不在全局作用域中添加多余的变量，我们将<strong>使用模块增强模式来封装检测脚本</strong>。检测脚本的基本代码结构如下所示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">client</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

	<span class="token keyword">var</span> engine <span class="token operator">=</span> <span class="token punctuation">{</span>
	
		<span class="token comment">//呈现引擎</span>
		ie<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		gecko<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		webkit<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		khtml<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		opera<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		
		<span class="token comment">//具体的版本号</span>
		ver<span class="token operator">:</span> <span class="token keyword">null</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	
	<span class="token comment">//在此检测呈现引擎、平台和设备</span>
	
	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		engine <span class="token operator">:</span> engine
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p>这里声明了一个名为client 的全局变量，用于保存相关信息。</p></li> <li><p>匿名函数内部定义了一个局部变量engine，它是一个包含默认设置的对象字面量。</p></li> <li><p>在这个对象字面量中，每个呈现引擎都对应着一个属性，属性的值默认为0。</p></li> <li><ul><li>如果检测到了哪个呈现引擎，那么就以浮点数值形式将该引擎的版本号写入相应的属性。</li> <li>而呈现引擎的完整版本（是一个字符串），则被写入ver 属性。</li></ul></li> <li><p>作这样的区分可以支持像下面这样编写代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>ie<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//如果是IE，client.ie 的值应该大于0</span>
	<span class="token comment">//针对IE 的代码</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>gecko <span class="token operator">&gt;</span> <span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>ver <span class="token operator">==</span> <span class="token string">&quot;1.8.1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">//针对这个版本执行某些操作</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>在检测到一个呈现引擎之后，其client.engine 中对应的属性将被设置为一个大于0 的值，该值可以转换成布尔值true。</p></li> <li><p>这样，就可以在if 语句中检测相应的属性，以确定当前使用的呈现引擎，连具体的版本号都不必考虑。</p></li> <li><p>鉴于每个属性都包含一个浮点数值，因此有可能丢失某些版本信息。</p></li> <li><ul><li>例如，将字符串&quot;1.8.1&quot;传入parseFloat()后会得到数值1.8。</li></ul></li> <li><p>不过，在必要的时候可以检测ver 属性，该属性中会保存完整的版本信息。</p></li></ul></li></ul></li> <li><p>要正确地识别呈现引擎，关键是检测顺序要正确。由于用户代理字符串存在诸多不一致的地方，如果检测顺序不对，很可能会导致检测结果不正确。</p></li> <li><ol><li><p>为此，第一步就是识别Opera，<strong>因为它的用户代理字符串有可能完全模仿其他浏览器</strong>。我们不相信Opera，是因为（任何情况下）其用户代理字符串（都）不会将自己标识为Opera。</p> <ul><li><p>要识别Opera，必须得检测<strong>window.opera 对象</strong>。</p> <ul><li>Opera 5 及更高版本中都有这个对象，用以保存与浏览器相关的标识信息以及与浏览器直接交互。</li> <li>在Opera 7.6 及更高版本中，调用version()方法可以返回一个表示浏览器版本的字符串，而这也是确定Opera版本号的最佳方式。</li> <li>要检测更早版本的Opera，可以直接检查用户代理字符串，因为那些版本还不支持隐瞒身份。不过，2007 底Opera 的最高版本已经是9.5 了，所以不太可能有人还在使用7.6 之前的版本。</li></ul></li> <li><p>那么，检测呈现引擎代码的第一步，就是编写如下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>opera<span class="token punctuation">)</span><span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> window<span class="token punctuation">.</span>opera<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>opera <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>这里，将版本的字符串表示保存在了engine.ver 中，将浮点数值表示的版本保存在了engine.opera 中。</li> <li>如果浏览器是Opera，测试window.opera 就会返回true；否则，就要看看是其他的什么浏览器了。</li></ul></li></ul></li> <li><p>应该放在第二位检测的呈现引擎是WebKit。<strong>因为WebKit 的用户代理字符串中包含&quot;Gecko&quot;和&quot;KHTML&quot;这两个子字符串</strong>，所以如果首先检测它们，很可能会得出错误的结论。</p> <ul><li><p>不过，WebKit 的用户代理字符串中的**&quot;AppleWebKit**&quot;是独一无二的，因此检测这个字符串最合适。</p></li> <li><p>下面就是检测该字符串的示例代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> ua <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>opera<span class="token punctuation">)</span><span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> window<span class="token punctuation">.</span>opera<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>opera <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">AppleWebKit\/(\S+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>webkit <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>代码首先将用户代理字符串保存在变量ua 中。</p></li> <li><p>然后通过正则表达式来测试是否包含字符串&quot;AppleWebKit&quot;，并使用捕获组来取得版本号。</p></li> <li><ul><li>由于实际的版本号中可能会包含数字、小数点和字母，所以捕获组中使用了表示非空格的特殊字符（\S）。</li> <li>用户代理字符串中的版本号与下一部分的分隔符是一个空格，因此这个模式可以保证捕获所有版本信息。</li></ul></li> <li><p>test()方法基于用户代理字符串运行正则表达式。</p></li> <li><ul><li>如果返回true，就将捕获的版本号保存在engine.ver 中，</li> <li>而将版本号的浮点表示保存在engine.webkit 中。</li></ul></li> <li><p>WebKit 版本与Safari 版本的详细对应情况如下表所示。</p> <table><thead><tr><th>Safari版本号</th> <th>最低限度的WebKit版本号</th></tr></thead> <tbody><tr><td>1.0至1.0.2</td> <td>85.7</td></tr> <tr><td>1.0.3</td> <td>85.8.2</td></tr> <tr><td>1.1至1.1.1</td> <td>100</td></tr> <tr><td>1.2.2</td> <td>125.2</td></tr> <tr><td>1.2.3</td> <td>125.4</td></tr> <tr><td>1.2.4</td> <td>125.5.5</td></tr> <tr><td>1.3</td> <td>312.1</td></tr> <tr><td>1.3.1</td> <td>312.5</td></tr> <tr><td>1.3.2</td> <td>312.8</td></tr> <tr><td>2.0</td> <td>412</td></tr> <tr><td>2.0.1</td> <td>412.7</td></tr> <tr><td>2.0.2</td> <td>416.11</td></tr> <tr><td>2.0.3</td> <td>417.9</td></tr> <tr><td>2.0.4</td> <td>418.8</td></tr> <tr><td>3.0.4</td> <td>523.10</td></tr> <tr><td>3.1</td> <td>525</td></tr></tbody></table> <ul><li>有时候，Safari 版本并不会与WebKit 版本严格地一一对应，也可能会存在某些小版本上的差异。</li> <li>这个表中只是列出了最可能的WebKit 版本，但不保证精确。</li></ul></li></ul></li></ul></li> <li><p>接下来要测试的呈现引擎是KHTML。同样，<strong>KHTML 的用户代理字符串中也包含&quot;Gecko&quot;，因此在排除KHTML 之前，我们无法准确检测基于Gecko 的浏览器</strong>。</p> <ul><li><p>KHTML 的版本号与WebKit 的版本号在用户代理字符串中的格式差不多，因此可以使用类似的正则表达式。</p></li> <li><p>此外，由于Konqueror 3.1 及更早版本中不包含<strong>KHTML</strong> 的版本，故而就要使用<strong>Konqueror</strong> 的版本来代替。</p></li> <li><p>下面就是相应的检测代码。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> ua <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>opera<span class="token punctuation">)</span><span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> window<span class="token punctuation">.</span>opera<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>opera <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">AppleWebKit\/(\S+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>webkit <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">KHTML\/(\S+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Konqueror\/([^;]+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>khtml <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>与前面一样，由于KHTML 的版本号与后继的标记之间有一个空格，因此仍然要使用特殊的非空格字符来取得与版本有关的所有字符。</p></li> <li><p>然后，将字符串形式的版本信息保存在engine.ver 中，将浮点数值形式的版本保存在engin.khtml 中。</p></li> <li><ul><li>如果KHTML 不在用户代理字符串中，那么就要匹配Konqueror后跟一个斜杠，再后跟不包含分号的所有字符。</li></ul></li></ul></li></ul></li> <li><p>在排除了WebKit 和KHTML 之后，就可以准确地检测Gecko 了。</p> <ul><li><p>但是，在用户代理字符串中，Gecko的版本号不会出现在字符串**&quot;Gecko&quot;<strong>的后面，而是会出现在字符串</strong>&quot;rv:&quot;**的后面。</p></li> <li><p>这样，我们就必须使用一个比前面复杂一些的正则表达式，</p></li> <li><p>如下所示。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> ua <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>opera<span class="token punctuation">)</span><span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> window<span class="token punctuation">.</span>opera<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>opera <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">AppleWebKit\/(\S+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>webkit <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">KHTML\/(\S+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>khtml <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">rv:([^\)]+)\) Gecko\/\d{8}</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>gecko <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>Gecko 的版本号位于字符串&quot;rv:&quot;与一个闭括号之间，因此为了提取出这个版本号，正则表达式要查找所有不是闭括号的字符，还要查找字符串&quot;Gecko/&quot;后跟8 个数字。</p></li> <li><p>如果上述模式匹配，就提取出版本号并将其保存在相应的属性中。</p></li> <li><p>Gecko 版本号与Firefox 版本号的对应关系如下表所示。</p> <table><thead><tr><th>Firefox版本号</th> <th>最低限度的Gecko版本号</th></tr></thead> <tbody><tr><td>1.0</td> <td>1.7.5</td></tr> <tr><td>1.5</td> <td>1.8.0</td></tr> <tr><td>2.0</td> <td>1.8.1</td></tr> <tr><td>3.0</td> <td>1.9.0</td></tr> <tr><td>3.5</td> <td>1.9.1</td></tr> <tr><td>3.6</td> <td>1.9.2</td></tr> <tr><td>4.0</td> <td>2.0.0</td></tr></tbody></table> <ul><li>与Safari 跟WebKit 一样，Firefox 与Gecko 的版本号也不一定严格对应。</li></ul></li></ul></li></ul></li> <li><p>最后一个要检测的呈现引擎就是IE 了。</p> <ul><li><p>IE 的版本号位于字符串&quot;MSIE&quot;的后面、一个分号的前面，因此相应的正则表达式非常简单，</p></li> <li><p>如下所示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> ua <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>opera<span class="token punctuation">)</span><span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> window<span class="token punctuation">.</span>opera<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>opera <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">AppleWebKit\/(\S+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>webkit <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">KHTML\/(\S+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>khtml <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">rv:([^\)]+)\) Gecko\/\d{8}</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>gecko <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">MSIE ([^;]+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>ie <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>以上呈现引擎检测脚本的最后一部分，就是在正则表达式中使用取反的字符类来取得不是分号的所有字符。</li> <li>IE 通常会保证以标准浮点数值形式给出其版本号，但有时候也不一定。因此，取反的字符类[^;]可以确保取得多个小数点以及任何可能的字符。</li></ul></li></ul></li></ol></li></ul> <p><em><strong>3. 识别浏览器</strong></em></p> <p>大多数情况下，识别了浏览器的呈现引擎就足以为我们采取正确的操作提供依据了。可是，只有呈现引擎还不能说明存在所需的JavaScript 功能。</p> <ul><li><p>苹果公司的Safari 浏览器和谷歌公司的Chrome 浏览器都使用WebKit 作为呈现引擎，但它们的JavaScript 引擎却不一样。</p></li> <li><ul><li>在这两款浏览器中，client.webkit都会返回非0 值，但仅知道这一点恐怕还不够。</li></ul></li> <li><p>对于它们，有必要像下面这样为client 对象再添加一些新的属性。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">client</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">var</span> engine <span class="token operator">=</span> <span class="token punctuation">{</span>
	
		<span class="token comment">//呈现引擎</span>
		ie<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		gecko<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		webkit<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		khtml<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		opera<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		
		<span class="token comment">//具体的版本</span>
		ver<span class="token operator">:</span> <span class="token keyword">null</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	
	<span class="token keyword">var</span> browser <span class="token operator">=</span> <span class="token punctuation">{</span>
	
		<span class="token comment">//浏览器</span>
		ie<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		firefox<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		safari<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		konq<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		opera<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		chrome<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		
		<span class="token comment">//具体的版本</span>
		ver<span class="token operator">:</span> <span class="token keyword">null</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	
	<span class="token comment">//在此检测呈现引擎、平台和设备</span>
	
	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		engine<span class="token operator">:</span> engine<span class="token punctuation">,</span>
		browser<span class="token operator">:</span> browser
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p>代码中又添加了私有变量browser，用于保存每个主要浏览器的属性。</p></li> <li><p>与engine 变量一样，除了当前使用的浏览器，其他属性的值将保持为0；如果是当前使用的浏览器，则这个属性中保存的是浮点数值形式的版本号。同样，ver 属性中在必要时将会包含字符串形式的浏览器完整版本号。</p></li> <li><p>由于大多数浏览器与其呈现引擎密切相关，所以下面示例中检测浏览器的代码与检测呈现引擎的代码是混合在一起的。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//检测呈现引擎及浏览器</span>
<span class="token keyword">var</span> ua <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>opera<span class="token punctuation">)</span><span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> browser<span class="token punctuation">.</span>ver <span class="token operator">=</span> window<span class="token punctuation">.</span>opera<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>opera <span class="token operator">=</span> browser<span class="token punctuation">.</span>opera <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">AppleWebKit\/(\S+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>webkit <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">//确定是Chrome 还是Safari</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Chrome\/(\S+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		browser<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		browser<span class="token punctuation">.</span>chrome <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>browser<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Version\/(\S+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		browser<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		browser<span class="token punctuation">.</span>safari <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>browser<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token comment">//近似地确定版本号</span>
		<span class="token keyword">var</span> safariVersion <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>engine<span class="token punctuation">.</span>webkit <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			safariVersion <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>engine<span class="token punctuation">.</span>webkit <span class="token operator">&lt;</span> <span class="token number">312</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			safariVersion <span class="token operator">=</span> <span class="token number">1.2</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>engine<span class="token punctuation">.</span>webkit <span class="token operator">&lt;</span> <span class="token number">412</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			safariVersion <span class="token operator">=</span> <span class="token number">1.3</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			safariVersion <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	
		browser<span class="token punctuation">.</span>safari <span class="token operator">=</span> browser<span class="token punctuation">.</span>ver <span class="token operator">=</span> safariVersion<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">KHTML\/(\S+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Konqueror\/([^;]+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> browser<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>khtml <span class="token operator">=</span> browser<span class="token punctuation">.</span>konq <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">rv:([^\)]+)\) Gecko\/\d{8}</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>gecko <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">//确定是不是Firefox</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Firefox\/(\S+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		browser<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		browser<span class="token punctuation">.</span>firefox <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>browser<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">MSIE ([^;]+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> browser<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>ie <span class="token operator">=</span> browser<span class="token punctuation">.</span>ie <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>对Opera 和IE 而言，browser 对象中的值等于engine 对象中的值。</p></li> <li><p>对Konqueror 而言，browser.konq 和browser.ver 属性分别等于engine.khtml 和engine.ver 属性。</p></li> <li><p>为了检测Chrome 和Safari，我们在检测引擎的代码中添加了if 语句。</p></li> <li><ul><li><p>提取Chrome 的版本号时，需要查找字符串**&quot;Chrome/&quot;**并取得该字符串后面的数值。</p></li> <li><p>而提取Safari 的版本号时，则需要查找字符串**&quot;Version/&quot;**并取得其后的数值。</p></li> <li><ul><li>由于这种方式仅适用于Safari 3 及更高版本，因此需要一些备用的代码，将WebKit 的版本号近似地映射为Safari 的版本号（参见上一小节中的表格）。</li></ul></li></ul></li> <li><p>在检测Firefox 的版本时，首先要找到字符串**&quot;Firefox/&quot;**，然后提取出该字符串后面的数值（即版本号）。当然，只有呈现引擎被判别为Gecko 时才会这样做。</p></li> <li><p>有了上面这些代码之后，我们就可以编写下面的逻辑。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>webkit<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//if it’s WebKit</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>browser<span class="token punctuation">.</span>chrome<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">//执行针对Chrome 的代码</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>browser<span class="token punctuation">.</span>safari<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">//执行针对Safari 的代码</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>gecko<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>browser<span class="token punctuation">.</span>firefox<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">//执行针对Firefox 的代码</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token comment">//执行针对其他Gecko 浏览器的代码</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ul></li></ul> <p><em><strong>4. 识别平台</strong></em></p> <p>很多时候，只要知道呈现引擎就足以编写出适当的代码了。但在某些条件下，平台可能是必须关注的问题。</p> <ul><li><p>那些具有各种平台版本的浏览器（如Safari、Firefox 和Opera）在不同的平台下可能会有不同的问题。</p></li> <li><p>目前的三大主流平台是Windows、Mac 和Unix（包括各种Linux）。为了检测这些平台，还需要像下面这样再添加一个新对象。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">client</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

	<span class="token keyword">var</span> engine <span class="token operator">=</span> <span class="token punctuation">{</span>
	
		<span class="token comment">//呈现引擎</span>
		ie<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		gecko<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		webkit<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		khtml<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		opera<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		
		<span class="token comment">//具体的版本号</span>
		ver<span class="token operator">:</span> <span class="token keyword">null</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> browser <span class="token operator">=</span> <span class="token punctuation">{</span>
	
		<span class="token comment">//浏览器</span>
		ie<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		firefox<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		safari<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		konq<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		opera<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		chrome<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		
		<span class="token comment">//具体的版本号</span>
		ver<span class="token operator">:</span> <span class="token keyword">null</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> system <span class="token operator">=</span> <span class="token punctuation">{</span>
		win<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		mac<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		x11<span class="token operator">:</span> <span class="token boolean">false</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	
	<span class="token comment">//在此检测呈现引擎、平台和设备</span>
	
	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		engine<span class="token operator">:</span> engine<span class="token punctuation">,</span>
		browser<span class="token operator">:</span> browser<span class="token punctuation">,</span>
		system<span class="token operator">:</span> system
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p>显然，上面的代码中又添加了一个包含3 个属性的新变量system。其中，win 属性表示是否为Windows 平台，mac 表示Mac，而x11 表示Unix。</p></li> <li><p>与呈现引擎不同，在不能访问操作系统或版本的情况下，平台信息通常是很有限的。对这三个平台而言，浏览器一般只报告Windows 版本。为此，新变量system 的每个属性最初都保存着布尔值false，而<strong>不是像呈现引擎属性那样保存着数字值</strong>。</p></li> <li><p>在确定平台时，检测<strong>navigator.platform 要比检测用户代理字符串更简单</strong>，后者在不同浏览器中会给出不同的平台信息。</p></li> <li><ul><li><p>navigator.platform 属性可能的值包括&quot;Win32&quot;、&quot;Win64&quot;、&quot;MacPPC&quot;、&quot;MacIntel&quot;、&quot;X11&quot;和&quot;Linux i686&quot;，这些值在不同的浏览器中都是一致的。检测平台的代码非常直观，</p></li> <li><p>如下所示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> p <span class="token operator">=</span> navigator<span class="token punctuation">.</span>platform<span class="token punctuation">;</span>
system<span class="token punctuation">.</span>win <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Win&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
system<span class="token punctuation">.</span>mac <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Mac&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
system<span class="token punctuation">.</span>x11 <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;X11&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Linux&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>以上代码使用indexOf()方法来查找平台字符串的开始位置。虽然&quot;Win32&quot;是当前浏览器唯一支持的Windows 字符串，但随着向64 位Windows 架构的迁移，将来很可能会出现&quot;Win64&quot;平台信息值。为了对此有所准备，检测平台的代码中查找的只是字符串&quot;Win&quot;的开始位置。而检测Mac 平台的方式也类似，同样是考虑到了MacPPC 和MacIntel。在检测Unix 时，则同时检查了字符串&quot;X11&quot;和&quot;Linux&quot;在平台字符串中的开始位置，从而确保了代码能够向前兼容其他变体。</li></ul></li> <li><p>Gecko 的早期版本在所有Windows 平台中都返回字符串&quot;Windows&quot;，在所有Mac 平台中则都返回字符串&quot;Macintosh&quot;。不过，这都是Firefox 1 发布以前的事了，Firefox 1确定了navigator.platform 的值。</p></li></ul></li></ul></li></ul> <p><em><strong>5. 识别Windows 操作系统</strong></em></p> <ul><li><p>在Windows 平台下，还可以从用户代理字符串中进一步取得具体的操作系统信息。</p></li> <li><ul><li><p>在Windows XP之前，Windows 有两种版本，分别针对家庭用户和商业用户。</p></li> <li><ul><li>针对家庭用户的版本分别是Windows 95、98 和Windows ME。</li> <li>而针对商业用户的版本则一直叫做Window NT，最后由于市场原因改名为Windows2000。</li> <li>这两个产品线后来又合并成一个由Windows NT 发展而来的公共的代码基，代表产品就是WindowsXP。</li></ul></li> <li><p>随后，微软在WindowsXP 基础上又构建了Windows Vista。</p></li></ul></li> <li><p>只有了解这些信息，才能搞清楚用户代理字符串中Windows 操作系统的具体版本。</p></li> <li><p>下表列出了不同浏览器在表示不同的Windows 操作系统时给出的不同字符串。</p> <table><thead><tr><th>Windows版本</th> <th>IE 4+</th> <th>Gecko</th> <th>Opera &lt; 7</th> <th>Opera 7+</th> <th>WebKit</th></tr></thead> <tbody><tr><td>95</td> <td>&quot;Windows  95&quot;</td> <td>&quot;Win95&quot;</td> <td>&quot;Windows  95&quot;</td> <td>&quot;Windows  95&quot;</td> <td>n/a</td></tr> <tr><td>98</td> <td>&quot;Windows  98&quot;</td> <td>&quot;Win98&quot;</td> <td>&quot;Windows  98&quot;</td> <td>&quot;Windows  98&quot;</td> <td>n/a</td></tr> <tr><td>NT 4.0</td> <td>&quot;Windows  NT&quot;</td> <td>&quot;WinNT4.0&quot;</td> <td>&quot;Windows NT  4.0&quot;</td> <td>&quot;Windows NT  4.0&quot;</td> <td>n/a</td></tr> <tr><td>2000</td> <td>&quot;Windows NT  5.0&quot;</td> <td>&quot;Windows NT  5.0&quot;</td> <td>&quot;Windows  2000&quot;</td> <td>&quot;Windows NT  5.0&quot;</td> <td>n/a</td></tr> <tr><td>ME</td> <td>&quot;Win 9x  4.90&quot;</td> <td>&quot;Win 9x  4.90&quot;</td> <td>&quot;Windows  ME&quot;</td> <td>&quot;Win 9x  4.90&quot;</td> <td>n/a</td></tr> <tr><td>XP</td> <td>&quot;Windows NT  5.1&quot;</td> <td>&quot;Windows NT  5.1&quot;</td> <td>&quot;Windows  XP&quot;</td> <td>&quot;Windows NT  5.1&quot;</td> <td>&quot;Windows NT  5.1&quot;</td></tr> <tr><td>Vista</td> <td>&quot;Windows NT  6.0&quot;</td> <td>&quot;Windows NT 6.0&quot;</td> <td>n/a</td> <td>&quot;Windows NT  6.0&quot;</td> <td>&quot;Windows NT  6.0&quot;</td></tr> <tr><td>7</td> <td>&quot;Windows NT  6.1&quot;</td> <td>&quot;Windows NT  6.1&quot;</td> <td>n/a</td> <td>&quot;Windows NT  6.1&quot;</td> <td>&quot;Windows NT  6.1&quot;</td></tr></tbody></table> <ul><li>由于用户代理字符串中的Windows 操作系统版本表示方法各异，因此检测代码并不十分直观。</li> <li>好在，从Windows 2000 开始，表示操作系统的字符串大部分都还相同，只有版本号有变化。</li></ul></li> <li><p>为了检测不同的Windows 操作系统，必须要使用正则表达式。</p> <p>由于使用Opera 7 之前版本的用户已经不多了，因此我们可以忽略这部分浏览器。</p> <ol><li><p>第一步就是匹配Windows 95 和Windows 98 这两个字符串。对这两个字符串，只有Gecko 与其他浏览器不同，即没有&quot;dows&quot;，而且&quot;Win&quot;与版本号之间没有空格。要匹配这个模式，可以使用下面这个简单的正则表达式。</p> <div class="language- extra-class"><pre class="language-text"><code>/Win(?:dows )?([^do]{2})/
</code></pre></div><ul><li>这个正则表达式中的捕获组会返回操作系统的版本。由于版本可能是任何两个字符编码（例如95、98、9x、NT、ME 及XP），因此要使用两个非空格字符。</li></ul></li> <li><p>Gecko 在表示Windows NT 时会在末尾添加&quot;4.0&quot;，与其查找实际的字符串，不如像下面这样查找小数值更合适。</p> <div class="language- extra-class"><pre class="language-text"><code>/Win(?:dows )?([^do]{2})(\d+\.\d+)?/
</code></pre></div><ul><li><p>这样，正则表达式中就包含了第二个捕获组，用于取得NT 的版本号。由于该版本号对于Windows95 和Windows 98 而言是不存在的，所以必须设置为可选。</p></li> <li><p>这个模式与Opera 表示Windows NT 的字符串之间唯一的区别，就是&quot;NT&quot;与&quot;4.0&quot;之间的空格，这在模式中很容易添加。</p> <div class="language- extra-class"><pre class="language-text"><code>/Win(?:dows )?([^do]{2})\s?(\d+\.\d+)?/
</code></pre></div></li></ul></li></ol></li> <li><p>经过一番修改之后，这个正则表达式也可以成功地匹配Windows ME、Windows XP 和Windows Vista的字符串了。</p></li> <li><ul><li>具体来说，第一个捕获组将会匹配95、98、9x、NT、ME 或XP。</li></ul></li> <li><ul><li>第二个捕获组则只针对Windows ME 及所有Windows NT 的变体。这个信息可以作为具体的操作系统信息保存在system.win属性中，</li></ul></li> <li><ul><li><p>如下所示。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>system<span class="token punctuation">.</span>win<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Win(?:dows )?([^do]{2})\s?(\d+\.\d+)?</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;NT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">switch</span><span class="token punctuation">(</span>RegExp<span class="token punctuation">[</span><span class="token string">&quot;$2&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">case</span> <span class="token string">&quot;5.0&quot;</span><span class="token operator">:</span>
					system<span class="token punctuation">.</span>win <span class="token operator">=</span> <span class="token string">&quot;2000&quot;</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> <span class="token string">&quot;5.1&quot;</span><span class="token operator">:</span>
					system<span class="token punctuation">.</span>win <span class="token operator">=</span> <span class="token string">&quot;XP&quot;</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> <span class="token string">&quot;6.0&quot;</span><span class="token operator">:</span>
					system<span class="token punctuation">.</span>win <span class="token operator">=</span> <span class="token string">&quot;Vista&quot;</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> <span class="token string">&quot;6.1&quot;</span><span class="token operator">:</span>
					system<span class="token punctuation">.</span>win <span class="token operator">=</span> <span class="token string">&quot;7&quot;</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">default</span><span class="token operator">:</span>
					system<span class="token punctuation">.</span>win <span class="token operator">=</span> <span class="token string">&quot;NT&quot;</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;9x&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			system<span class="token punctuation">.</span>win <span class="token operator">=</span> <span class="token string">&quot;ME&quot;</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			system<span class="token punctuation">.</span>win <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>如果system.win 的值为true，那么就使用这个正则表达式从用户代理字符串中提取具体的信息。</p></li> <li><p>鉴于Windows 将来的某个版本也许不能使用这个方法来检测，所以第一步应该先检测用户代理字符串是否与这个模式匹配。</p></li> <li><p>在模式匹配的情况下，第一个捕获组中可能会包含&quot;95&quot;、&quot;98&quot;、&quot;9x&quot;或&quot;NT&quot;。</p></li> <li><p>如果这个值是&quot;NT&quot;，可以将system.win 设置为相应操作系统的字符串；如果是&quot;9x&quot;，那么system.win就要设置成&quot;ME&quot;；如果是其他值，则将所捕获的值直接赋给system.win。</p></li> <li><p>有了这些检测平台的代码后，我们就可以编写如下代码。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>system<span class="token punctuation">.</span>win<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>system<span class="token punctuation">.</span>win <span class="token operator">==</span> <span class="token string">&quot;XP&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//说明是XP</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>system<span class="token punctuation">.</span>win <span class="token operator">==</span> <span class="token string">&quot;Vista&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">//说明是Vista</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>由于非空字符串会转换为布尔值true，因此可以将client.system.win 作为布尔值用在if 语句中。而在需要更多有关操作系统的信息时，则可以使用其中保存的字符串值。</li></ul></li></ul></li></ul></li></ul> <p><em><strong>6. 识别移动设备</strong></em></p> <p>2006 年到2007 年，移动设备中Web 浏览器的应用呈爆炸性增长。四大主要浏览器都推出了手机版和在其他设备中运行的版本。</p> <ul><li><p>要检测相应的设备，第一步是为要检测的所有移动设备添加属性，如下所示。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">client</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

	<span class="token keyword">var</span> engine <span class="token operator">=</span> <span class="token punctuation">{</span>
	
		<span class="token comment">//呈现引擎</span>
		ie<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		gecko<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		webkit<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		khtml<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		opera<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		
		<span class="token comment">//具体的版本号</span>
		ver<span class="token operator">:</span> <span class="token keyword">null</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	
	<span class="token keyword">var</span> browser <span class="token operator">=</span> <span class="token punctuation">{</span>
	
		<span class="token comment">//浏览器</span>
		ie<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		firefox<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		safari<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		konq<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		opera<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		chrome<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		
		<span class="token comment">//具体的版本号</span>
		ver<span class="token operator">:</span> <span class="token keyword">null</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	
	<span class="token keyword">var</span> system <span class="token operator">=</span> <span class="token punctuation">{</span>
		win<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		mac<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		x11<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		
		<span class="token comment">//移动设备</span>
		iphone<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		ipod<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		ipad<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		ios<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		android<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		nokiaN<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		winMobile<span class="token operator">:</span> <span class="token boolean">false</span> 
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	
	<span class="token comment">//在此检测呈现引擎、平台和设备</span>
	
	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		engine<span class="token operator">:</span> engine<span class="token punctuation">,</span>
		browser<span class="token operator">:</span> browser<span class="token punctuation">,</span>
		system<span class="token operator">:</span> system
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol><li><p>然后，通常<strong>简单地检测字符串&quot;iPhone&quot;、&quot;iPod&quot;和&quot;iPad&quot;</strong>，就可以分别设置相应属性的值了。</p> <div class="language-js extra-class"><pre class="language-js"><code>system<span class="token punctuation">.</span>iphone <span class="token operator">=</span> ua<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;iPhone&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
system<span class="token punctuation">.</span>ipod <span class="token operator">=</span> ua<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;iPod&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
system<span class="token punctuation">.</span>ipod <span class="token operator">=</span> ua<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;iPad&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p>除了知道iOS 设备，最好还能知道iOS 的版本号。</p></li> <li><ul><li><p>在iOS 3 之前，用户代理字符串中只包含&quot;CPU like Mac OS&quot;，后来iPhone 中又改成&quot;CPU iPhone      OS 3_0 like Mac OS X&quot;，iPad 中又改成&quot;CPU OS 3_2 like Mac OS      X&quot;。</p></li> <li><p>也就是说，检测iOS 需要正则表达式反映这些变化。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//检测iOS 版本</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>system<span class="token punctuation">.</span>mac <span class="token operator">&amp;&amp;</span> ua<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Mobile&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">CPU (?:iPhone )?OS (\d+_\d+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		system<span class="token punctuation">.</span>ios <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>RegExp<span class="token punctuation">.</span>$<span class="token number">1.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		system<span class="token punctuation">.</span>ios <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">//不能真正检测出来，所以只能猜测</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>检查系统是不是Mac OS、字符串中是否存在&quot;Mobile&quot;，可以保证无论是什么版本，system.ios中都不会是0。</li> <li>然后，再使用正则表达式确定是否存在iOS 的版本号。</li> <li>如果有，将system.ios 设置为表示版本号的浮点值；否则，将版本设置为2。（因为没有办法确定到底是什么版本，所以设置为更早的版本比较稳妥。）</li></ul></li></ul></li></ul></li> <li><p>检测Android 操作系统也很简单，也就是搜索**字符串&quot;Android&quot;**并取得紧随其后的版本号。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//检测Android 版本</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Android (\d+\.\d+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	system<span class="token punctuation">.</span>android <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>RegExp<span class="token punctuation">.</span>$<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>由于所有版本的Android 都有版本值，因此这个正则表达式可以精确地检测所有版本，并将system.android 设置为正确的值。</p></li> <li><p>诺基亚N 系列手机使用的也是WebKit，其用户代理字符串与其他基于WebKit 的手机很相似，例如：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/5.0 (SymbianOS/9.2; U; Series60/3.1 NokiaN95/11.0.026; Profile MIDP-2.0Configuration/CLDC-1.1) AppleWebKit/413 (KHTML, like Gecko) Safari/413
</code></pre></div><ul><li>虽然诺基亚N 系列手机在用户代理字符串中声称使用的是&quot;Safari&quot;，但实际上并不是Safari，尽管确实是基于WebKit 引擎。</li></ul></li></ul></li> <li><p>只要像下面检测一下用户代理字符串中是否存在**&quot;NokiaN&quot;**，就足以确定是不是该系列的手机了。</p> <div class="language-js extra-class"><pre class="language-js"><code>system<span class="token punctuation">.</span>nokiaN <span class="token operator">=</span> ua<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;NokiaN&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p>在了解这些设备信息的基础上，就可以通过下列代码来确定用户使用的是什么设备中的WebKit 来访问网页：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>webkit<span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>system<span class="token punctuation">.</span> iOS<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">//iOS 手机的内容</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>system<span class="token punctuation">.</span>android<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">//Android 手机的内容</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>system<span class="token punctuation">.</span>nokiaN<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token comment">//诺基亚手机的内容</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li> <li><p>最后一种主要的移动设备平台是Windows Mobile（也称为Windows CE），用于Pocket PC 和Smartphone 中。由于从技术上说这些平台都属于Windows 平台，因此Windows 平台和操作系统都会返回正确的值。对于Windows Mobile 5.0 及以前版本，这两种设备的用户代理字符串非常相似，如下所示：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/4.0 (compatible; MSIE 4.01; Windows CE; PPC; 240x320)
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>Mozilla/4.0 (compatible; MSIE 4.01; Windows CE; Smartphone; 176x220)
</code></pre></div><ul><li><p>第一个来自Pocket PC 中的移动Internet Explorer 4.01，第二个来自Smartphone 中的同一个浏览器。</p></li> <li><p>当Windows 操作系统检测脚本检测这两个字符串时，system.win 将被设置为**&quot;CE&quot;**，因此在检测Windows Mobile 时可以使用这个值：</p> <div class="language-js extra-class"><pre class="language-js"><code>system<span class="token punctuation">.</span>winMobile <span class="token operator">=</span> <span class="token punctuation">(</span>system<span class="token punctuation">.</span>win <span class="token operator">==</span> <span class="token string">&quot;CE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>不建议测试字符串中的&quot;PPC&quot;或&quot;Smartphone&quot;，因为在Windows Mobile 5.0 以后版本的浏览器中，这些记号已经被移除了。</p></li> <li><p>不过，一般情况下，只知道某个设备使用的是Windows Mobile 也就足够了。</p></li> <li><p>Windows Phone 7 的用户代理字符串稍有改进，基本格式如下：</p> <div class="language- extra-class"><pre class="language-text"><code>Mozilla/4.0 (compatible; MSIE 7.0; Windows Phone OS 7.0; Trident/3.1; IEMobile/7.0) Asus;Galaxy6
</code></pre></div><ul><li>其中，Windows 操作符的标识符与已往完全不同，因此在这个用户代理中client.system.win等于**&quot;Ph&quot;**。</li></ul></li> <li><p>从中可以取得有关系统的更多信息：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//windows mobile</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>system<span class="token punctuation">.</span>win <span class="token operator">==</span> <span class="token string">&quot;CE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	system<span class="token punctuation">.</span>winMobile <span class="token operator">=</span> system<span class="token punctuation">.</span>win<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>system<span class="token punctuation">.</span>win <span class="token operator">==</span> <span class="token string">&quot;Ph&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Windows Phone OS (\d+.\d+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">;</span>
		system<span class="token punctuation">.</span>win <span class="token operator">=</span> <span class="token string">&quot;Phone&quot;</span><span class="token punctuation">;</span>
		system<span class="token punctuation">.</span>winMobile <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>如果system.win 的值是&quot;CE&quot;，就说明是老版本的Windows Mobile，因此system.winMobile会被设置为相同的值（只能知道这个信息）。</li> <li>如果system.win 的值是&quot;Ph&quot;，那么这个设备就可能是Windows Phone 7 或更新版本。因此就用正则表达式来测试格式并提取版本号，将system.win 的值重置为&quot;Phone&quot;，而将system.winMobile 设置为版本号。</li></ul></li></ul></li></ol></li></ul> <p><em><strong>7. 识别游戏系统</strong></em></p> <p>除了移动设备之外，视频游戏系统中的Web 浏览器也开始日益普及。</p> <ul><li><p>任天堂Wii 和Playstation 3 或者内置Web 浏览器，或者提供了浏览器下载。</p></li> <li><ul><li>Wii 中的浏览器实际上是定制版的Opera，是专门为WiiRemote 设计的。</li> <li>Playstation 的浏览器是自己开发的，没有基于前面提到的任何呈现引擎。</li></ul></li> <li><p>这两个浏览器中的用户代理字符串如下所示：</p> <div class="language- extra-class"><pre class="language-text"><code>Opera/9.10 (Nintendo Wii;U; ; 1621; en)
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>Mozilla/5.0 (PLAYSTATION 3; 2.00)
</code></pre></div><ul><li>第一个字符串来自运行在Wii 中的Opera，它忠实地继承了Opera 最初的用户代理字符串格式（Wii上的Opera 不具备隐瞒身份的能力）。</li> <li>第二个字符串来自Playstation3，虽然它为了兼容性而将自己标识为Mozilla 5.0，但并没有给出太多信息。而且，设备名称居然全部使用了大写字母，让人觉得很奇怪；强烈希望将来的版本能够改变这种情况。</li></ul></li> <li><p>在检测这些设备以前，我们必须先为client.system 中添加适当的属性，如下所示：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">client</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	
	<span class="token keyword">var</span> engine <span class="token operator">=</span> <span class="token punctuation">{</span>
	
		<span class="token comment">//呈现引擎</span>
		ie<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		gecko<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		webkit<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		khtml<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		opera<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		
		<span class="token comment">//具体的版本号</span>
		ver<span class="token operator">:</span> <span class="token keyword">null</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	
	<span class="token keyword">var</span> browser <span class="token operator">=</span> <span class="token punctuation">{</span>
	
		<span class="token comment">//浏览器</span>
		ie<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		firefox<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		safari<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		konq<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		opera<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		chrome<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		
		<span class="token comment">//具体的版本号</span>
		ver<span class="token operator">:</span> <span class="token keyword">null</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	
	<span class="token keyword">var</span> system <span class="token operator">=</span> <span class="token punctuation">{</span>
		win<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		mac<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		x11<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		
		<span class="token comment">//移动设备</span>
		iphone<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		ipod<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		ipad<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		ios<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		android<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		nokiaN<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		winMobile<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		
		<span class="token comment">//游戏系统</span>
		wii<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		ps<span class="token operator">:</span> <span class="token boolean">false</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	
	<span class="token comment">//在此检测呈现引擎、平台和设备</span>
	
	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		engine<span class="token operator">:</span> engine<span class="token punctuation">,</span>
		browser<span class="token operator">:</span> browser<span class="token punctuation">,</span>
		system<span class="token operator">:</span> system
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p>检测前述游戏系统的代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>system<span class="token punctuation">.</span>wii <span class="token operator">=</span> ua<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Wii&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
system<span class="token punctuation">.</span>ps <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">playstation</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p>对于Wii，只要检测**字符串&quot;Wii&quot;**就够了，而其他代码将发现这是一个Opera 浏览器，并将正确的版本号保存在client.browser.opera 中。</p></li> <li><p>对于Playstation，我们则使用<strong>正则表达式来以不区分大小写的方式测试用户代理字符串</strong>。</p></li></ul></li></ul></li></ul> <h3 id="_9-3-3-完整的代码"><a href="#_9-3-3-完整的代码" class="header-anchor">#</a> 9.3.3 完整的代码</h3> <p><em><strong>1. 完整的代码</strong></em></p> <p>以下是完整的用户代理字符串检测脚本，包括检测呈现引擎、平台、Windows 操作系统、移动设备和游戏系统。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">client</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//呈现引擎</span>
	<span class="token keyword">var</span> engine <span class="token operator">=</span> <span class="token punctuation">{</span>
		ie<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		gecko<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		webkit<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		khtml<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		opera<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		
		<span class="token comment">//完整的版本号</span>
		ver<span class="token operator">:</span> <span class="token keyword">null</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	
	<span class="token comment">//浏览器</span>
	<span class="token keyword">var</span> browser <span class="token operator">=</span> <span class="token punctuation">{</span>
	
		<span class="token comment">//主要浏览器</span>
		ie<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		firefox<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		safari<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		konq<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		opera<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		chrome<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		
		<span class="token comment">//具体的版本号</span>
		ver<span class="token operator">:</span> <span class="token keyword">null</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	
	<span class="token comment">//平台、设备和操作系统</span>
	<span class="token keyword">var</span> system <span class="token operator">=</span> <span class="token punctuation">{</span>
		win<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		mac<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		x11<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		
		<span class="token comment">//移动设备</span>
		iphone<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		ipod<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		ipad<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		ios<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		android<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		nokiaN<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		winMobile<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		
		<span class="token comment">//游戏系统</span>
		wii<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		ps<span class="token operator">:</span> <span class="token boolean">false</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	
	<span class="token comment">//检测呈现引擎和浏览器</span>
	<span class="token keyword">var</span> ua <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>opera<span class="token punctuation">)</span><span class="token punctuation">{</span>
		engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> browser<span class="token punctuation">.</span>ver <span class="token operator">=</span> window<span class="token punctuation">.</span>opera<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		engine<span class="token punctuation">.</span>opera <span class="token operator">=</span> browser<span class="token punctuation">.</span>opera <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">AppleWebKit\/(\S+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		engine<span class="token punctuation">.</span>webkit <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">//确定是Chrome 还是Safari</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Chrome\/(\S+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			browser<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			browser<span class="token punctuation">.</span>chrome <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>browser<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Version\/(\S+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			browser<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			browser<span class="token punctuation">.</span>safari <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>browser<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token comment">//近似地确定版本号</span>
			<span class="token keyword">var</span> safariVersion <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>engine<span class="token punctuation">.</span>webkit <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			safariVersion <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>engine<span class="token punctuation">.</span>webkit <span class="token operator">&lt;</span> <span class="token number">312</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			safariVersion <span class="token operator">=</span> <span class="token number">1.2</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>engine<span class="token punctuation">.</span>webkit <span class="token operator">&lt;</span> <span class="token number">412</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			safariVersion <span class="token operator">=</span> <span class="token number">1.3</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			safariVersion <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			
			browser<span class="token punctuation">.</span>safari <span class="token operator">=</span> browser<span class="token punctuation">.</span>ver <span class="token operator">=</span> safariVersion<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">KHTML\/(\S+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Konqueror\/([^;]+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> browser<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		engine<span class="token punctuation">.</span>khtml <span class="token operator">=</span> browser<span class="token punctuation">.</span>konq <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">rv:([^\)]+)\) Gecko\/\d{8}</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		engine<span class="token punctuation">.</span>gecko <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">//确定是不是Firefox</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Firefox\/(\S+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			browser<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			browser<span class="token punctuation">.</span>firefox <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>browser<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">MSIE ([^;]+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> browser<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		engine<span class="token punctuation">.</span>ie <span class="token operator">=</span> browser<span class="token punctuation">.</span>ie <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//检测浏览器</span>
	browser<span class="token punctuation">.</span>ie <span class="token operator">=</span> engine<span class="token punctuation">.</span>ie<span class="token punctuation">;</span>
	browser<span class="token punctuation">.</span>opera <span class="token operator">=</span> engine<span class="token punctuation">.</span>opera<span class="token punctuation">;</span>
	
	<span class="token comment">//检测平台</span>
	<span class="token keyword">var</span> p <span class="token operator">=</span> navigator<span class="token punctuation">.</span>platform<span class="token punctuation">;</span>
	system<span class="token punctuation">.</span>win <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Win&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
	system<span class="token punctuation">.</span>mac <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Mac&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
	system<span class="token punctuation">.</span>x11 <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> <span class="token string">&quot;X11&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Linux&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">//检测Windows 操作系统</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>system<span class="token punctuation">.</span>win<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Win(?:dows )?([^do]{2})\s?(\d+\.\d+)?</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;NT&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">switch</span><span class="token punctuation">(</span>RegExp<span class="token punctuation">[</span><span class="token string">&quot;$2&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token keyword">case</span> <span class="token string">&quot;5.0&quot;</span><span class="token operator">:</span>
						system<span class="token punctuation">.</span>win <span class="token operator">=</span> <span class="token string">&quot;2000&quot;</span><span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> <span class="token string">&quot;5.1&quot;</span><span class="token operator">:</span>
						system<span class="token punctuation">.</span>win <span class="token operator">=</span> <span class="token string">&quot;XP&quot;</span><span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> <span class="token string">&quot;6.0&quot;</span><span class="token operator">:</span>
						system<span class="token punctuation">.</span>win <span class="token operator">=</span> <span class="token string">&quot;Vista&quot;</span><span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> <span class="token string">&quot;6.1&quot;</span><span class="token operator">:</span>
						system<span class="token punctuation">.</span>win <span class="token operator">=</span> <span class="token string">&quot;7&quot;</span><span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">default</span><span class="token operator">:</span>
						system<span class="token punctuation">.</span>win <span class="token operator">=</span> <span class="token string">&quot;NT&quot;</span><span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;9x&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				system<span class="token punctuation">.</span>win <span class="token operator">=</span> <span class="token string">&quot;ME&quot;</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				system<span class="token punctuation">.</span>win <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//移动设备</span>
	system<span class="token punctuation">.</span>iphone <span class="token operator">=</span> ua<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;iPhone&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	system<span class="token punctuation">.</span>ipod <span class="token operator">=</span> ua<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;iPod&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	system<span class="token punctuation">.</span>ipad <span class="token operator">=</span> ua<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;iPad&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	system<span class="token punctuation">.</span>nokiaN <span class="token operator">=</span> ua<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;NokiaN&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	
	<span class="token comment">//windows mobile</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>system<span class="token punctuation">.</span>win <span class="token operator">==</span> <span class="token string">&quot;CE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		system<span class="token punctuation">.</span>winMobile <span class="token operator">=</span> system<span class="token punctuation">.</span>win<span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>system<span class="token punctuation">.</span>win <span class="token operator">==</span> <span class="token string">&quot;Ph&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Windows Phone OS (\d+.\d+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">;</span>
			system<span class="token punctuation">.</span>win <span class="token operator">=</span> <span class="token string">&quot;Phone&quot;</span><span class="token punctuation">;</span>
			system<span class="token punctuation">.</span>winMobile <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//检测iOS 版本</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>system<span class="token punctuation">.</span>mac <span class="token operator">&amp;&amp;</span> ua<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Mobile&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">CPU (?:iPhone )?OS (\d+_\d+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			system<span class="token punctuation">.</span>ios <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>RegExp<span class="token punctuation">.</span>$<span class="token number">1.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			system<span class="token punctuation">.</span>ios <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">//不能真正检测出来，所以只能猜测</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//检测Android 版本</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Android (\d+\.\d+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		system<span class="token punctuation">.</span>android <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>RegExp<span class="token punctuation">.</span>$<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//游戏系统</span>
	system<span class="token punctuation">.</span>wii <span class="token operator">=</span> ua<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Wii&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	system<span class="token punctuation">.</span>ps <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">playstation</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">//返回这些对象</span>
	<span class="token keyword">return</span> <span class="token punctuation">{</span>
		engine<span class="token operator">:</span> engine<span class="token punctuation">,</span>
		browser<span class="token operator">:</span> browser<span class="token punctuation">,</span>
		system<span class="token operator">:</span> system
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_9-3-4-使用方法"><a href="#_9-3-4-使用方法" class="header-anchor">#</a> 9.3.4 使用方法</h3> <p>***1. ***</p> <p>我们在前面已经强调过了，用户代理检测是客户端检测的最后一个选择。只要可能，都应该优先采用能力检测和怪癖检测。</p> <p>用户代理检测一般适用于下列情形。</p> <ul><li><p>不能直接准确地使用能力检测或怪癖检测。</p></li> <li><ul><li>例如，某些浏览器实现了为将来功能预留的存根（stub）函数。在这种情况下，仅测试相应的函数是否存在还得不到足够的信息。</li></ul></li> <li><p>同一款浏览器在不同平台下具备不同的能力。</p></li> <li><ul><li>这时候，可能就有必要确定浏览器位于哪个平台下。</li></ul></li> <li><p>为了跟踪分析等目的需要知道确切的浏览器。</p></li></ul> <h2 id="_9-4-小结"><a href="#_9-4-小结" class="header-anchor">#</a> 9.4 小结</h2> <p>客户端检测是JavaScript 开发中最具争议的一个话题。由于浏览器间存在差别，通常需要根据不同浏览器的能力分别编写不同的代码。</p> <p><em><strong>1. 客户端检测方法</strong></em></p> <p>有不少客户端检测方法，但下列是最经常使用的。</p> <ul><li><p>能力检测：在编写代码之前先检测特定浏览器的能力。</p></li> <li><ul><li>例如，脚本在调用某个函数之前，可能要先检测该函数是否存在。</li> <li>这种检测方法将开发人员从考虑具体的浏览器类型和版本中解放出来，让他们<strong>把注意力集中到相应的能力是否存在上</strong>。</li> <li>能力检测无法精确地检测特定的浏览器和版本。</li></ul></li> <li><p>怪癖检测：怪癖实际上是浏览器实现中存在的bug，</p></li> <li><ul><li>例如早期的WebKit 中就存在一个怪癖，即它会在for-in 循环中返回被隐藏的属性。</li> <li>怪癖检测通常涉及到运行一小段代码，然后确定浏览器是否存在某个怪癖。</li> <li>由于怪癖检测与能力检测相比效率更低，因此应该<strong>只在某个怪癖会干扰脚本运行的情况下使用</strong>。</li> <li>怪癖检测无法精确地检测特定的浏览器和版本。</li></ul></li> <li><p>用户代理检测：通过检测用户代理字符串来识别浏览器。</p></li> <li><ul><li>用户代理字符串中包含大量与浏览器有关的信息，包括浏览器、平台、操作系统及浏览器版本。</li> <li>用户代理字符串有过一段相当长的发展历史，在此期间，浏览器提供商试图通过在用户代理字符串中<strong>添加一些欺骗性信息</strong>，欺骗网站相信自己的浏览器是另外一种浏览器。</li> <li>用户代理检测需要特殊的技巧，特别是要注意<strong>Opera会隐瞒其用户代理字符串</strong>的情况。</li> <li>即便如此，通过用户代理字符串仍然能够检测出浏览器所用的呈现引擎以及所在的平台，包括移动设备和游戏系统。</li></ul></li></ul> <p><em><strong>2. 使用哪种客户端检测方法</strong></em></p> <p>使用哪种客户端检测方法</p> <ol><li>在决定使用哪种客户端检测方法时，一般应优先考虑使用能力检测。</li> <li>怪癖检测是确定应该如何处理代码的第二选择。</li> <li>而用户代理检测则是客户端检测的最后一种方案，因为这种方法对用户代理字符串具有很强的依赖性。</li></ol></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/df56f8/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">第8章 BOM</div></a> <a href="/pages/db0f5b/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">第10章 DOM</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/df56f8/" class="prev">第8章 BOM</a></span> <span class="next"><a href="/pages/db0f5b/">第10章 DOM</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/1c4e14/"><div>你想知道的css hack知识全都帮你整理好了</div></a> <span>06-08</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/d8a080/"><div>问题和经验</div></a> <span>06-08</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/a93118/"><div>CSS Hack</div></a> <span>06-08</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:894072666@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/xugaoyi" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2021
    <span>Evan Xu | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.40794b05.js" defer></script><script src="/assets/js/2.21c2c3d2.js" defer></script><script src="/assets/js/185.1b24284f.js" defer></script>
  </body>
</html>